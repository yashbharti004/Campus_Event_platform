<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campus Event Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --sidebar-width: 256px;
        }
        .animate-fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(10px) scale(0.98); } 
            to { opacity: 1; transform: translateY(0) scale(1); } 
        }
        
        /* Toast Notification */
        @keyframes slideInUp { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes fadeOut { to { opacity: 0; } }
        .toast {
            animation: slideInUp 0.5s ease-out, fadeOut 0.5s ease-in 2.5s forwards;
        }

        /* Hamburger Menu Animation */
        .hamburger {
            cursor: pointer;
            width: 24px;
            height: 24px;
            transition: all 0.25s;
            position: relative;
        }
        .hamburger-top,
        .hamburger-middle,
        .hamburger-bottom {
            position: absolute;
            width: 24px;
            height: 2px;
            top: 0;
            left: 0;
            background: #4a5568;
            transform: rotate(0);
            transition: all 0.5s;
        }
        .hamburger-middle {
            transform: translateY(7px);
        }
        .hamburger-bottom {
            transform: translateY(14px);
        }
        .hamburger.open .hamburger-top {
            transform: rotate(45deg) translateY(6px) translateX(6px);
        }
        .hamburger.open .hamburger-middle {
            display: none;
        }
        .hamburger.open .hamburger-bottom {
            transform: rotate(-45deg) translateY(6px) translateX(-6px);
        }
        
        /* Shining Badge Animation */
        @keyframes shine {
            0% { background-position: -200% center; }
            100% { background-position: 200% center; }
        }
        .shining-badge {
            background: linear-gradient(to right, #10B981, #34D399, #A7F3D0, #34D399, #10B981);
            background-size: 200% auto;
            color: white;
            animation: shine 2.5s linear infinite;
        }

        /* Pulse Animation for Live Events */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .pulse-live {
            animation: pulse 2s infinite;
        }

        /* General smooth transition class */
        .smooth-transition {
            transition: all 0.3s ease-in-out;
        }
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
        }

        /* Event Card Styles */
        .event-card {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-left: 4px solid;
        }
        .event-card.tech { border-left-color: #3b82f6; }
        .event-card.cultural { border-left-color: #8b5cf6; }
        .event-card.sports { border-left-color: #10b981; }
        .event-card.academic { border-left-color: #f59e0b; }
        .event-card.workshop { border-left-color: #ec4899; }

        /* Countdown Timer */
        .countdown-digit {
            background: #1e293b;
            color: white;
            border-radius: 4px;
            padding: 2px 6px;
            font-weight: bold;
            font-size: 0.875rem;
        }

        /* Responsive Table to Card CSS */
        @media (max-width: 768px) {
            .responsive-table thead {
                display: none;
            }
            .responsive-table tr {
                display: block;
                border: 1px solid #e5e7eb;
                border-radius: 0.75rem;
                padding: 1rem;
                margin-bottom: 1rem;
                box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            }
             .responsive-table tr:last-child {
                margin-bottom: 0;
            }
            .responsive-table td {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 0.5rem 0;
                border: none;
            }
             .responsive-table td:first-child {
                padding-top: 0;
            }
             .responsive-table td:last-child {
                padding-bottom: 0;
            }
            .responsive-table td::before {
                content: attr(data-label);
                font-weight: 600;
                text-transform: capitalize;
                color: #4b5563;
            }
        }

        /* Chart container styles */
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans text-gray-900">

    <div id="app-container">
        <!-- App content will be rendered here -->
    </div>
    <div id="toast-container" class="fixed bottom-5 right-5 z-[100]"></div>

    <script type="module">
        // Initialize Lucide icons
        lucide.createIcons();

        // --- MOCK DATA ---
        const mockData = {
            student: {
                name: "Priya Sharma",
                id: 101,
                profile: {
                    name: "Priya Sharma",
                    headline: "Computer Science Student | Event Enthusiast",
                    profilePicUrl: "https://placehold.co/128x128/E0E7FF/4F46E5?text=PS",
                    about: "I'm passionate about technology events and cultural activities. Always looking for opportunities to learn and network.",
                    interests: ["Technology", "Coding", "Music", "Dance", "Sports"],
                    department: "Computer Science",
                    year: "3rd Year"
                }
            },
            faculty: {
                name: "Dr. Ramesh Gupta",
                department: "Computer Science",
                role: "Faculty Coordinator",
                managedEvents: [1, 3, 5] // Event IDs this faculty manages
            },
            admin: {
                name: "Dr. Anjali Mehta",
                role: "Event Administrator"
            },
            events: [
                {
                    id: 1,
                    title: "Annual Tech Fest",
                    description: "The biggest technology festival of the year with coding competitions, workshops, and tech talks.",
                    category: "tech",
                    date: "2025-11-15T09:00:00",
                    endDate: "2025-11-17T18:00:00",
                    location: "Main Auditorium & CS Department",
                    organizer: "Computer Science Department",
                    capacity: 500,
                    registered: 342,
                    image: "https://placehold.co/600x400/3B82F6/FFFFFF?text=Tech+Fest",
                    status: "upcoming",
                    tags: ["coding", "workshops", "competitions"],
                    registrationDeadline: "2025-11-10T23:59:00",
                    isRegistered: true,
                    reminders: ["2025-11-14T09:00:00", "2025-11-15T08:00:00"],
                    facultyCoordinator: "Dr. Ramesh Gupta",
                    participants: [
                        { id: 101, name: "Priya Sharma", email: "priya.sharma@gec.ac.in", department: "Computer Science", checkIn: null },
                        { id: 102, name: "Rohan Mehra", email: "rohan.mehra@gec.ac.in", department: "Computer Science", checkIn: null },
                        { id: 103, name: "Aarav Kumar", email: "aarav.kumar@gec.ac.in", department: "IT", checkIn: "2025-11-15T09:15:00" }
                    ]
                },
                {
                    id: 2,
                    title: "Cultural Night",
                    description: "An evening of music, dance, and performances from various cultures.",
                    category: "cultural",
                    date: "2025-10-25T18:00:00",
                    endDate: "2025-10-25T22:00:00",
                    location: "College Ground",
                    organizer: "Cultural Committee",
                    capacity: 1000,
                    registered: 876,
                    image: "https://placehold.co/600x400/8B5CF6/FFFFFF?text=Cultural+Night",
                    status: "upcoming",
                    tags: ["music", "dance", "performances"],
                    registrationDeadline: "2025-10-24T23:59:00",
                    isRegistered: false,
                    reminders: ["2025-10-24T18:00:00", "2025-10-25T12:00:00"],
                    facultyCoordinator: "Dr. Sunita Patel",
                    participants: []
                },
                {
                    id: 3,
                    title: "Inter-College Sports Tournament",
                    description: "Annual sports competition featuring basketball, cricket, and football.",
                    category: "sports",
                    date: "2025-11-05T08:00:00",
                    endDate: "2025-11-07T18:00:00",
                    location: "Sports Complex",
                    organizer: "Sports Department",
                    capacity: 300,
                    registered: 245,
                    image: "https://placehold.co/600x400/10B981/FFFFFF?text=Sports+Tournament",
                    status: "upcoming",
                    tags: ["basketball", "cricket", "football"],
                    registrationDeadline: "2025-11-01T23:59:00",
                    isRegistered: true,
                    reminders: ["2025-11-04T08:00:00", "2025-11-05T07:00:00"],
                    facultyCoordinator: "Dr. Ramesh Gupta",
                    participants: [
                        { id: 101, name: "Priya Sharma", email: "priya.sharma@gec.ac.in", department: "Computer Science", checkIn: null },
                        { id: 104, name: "Vikram Singh", email: "vikram.singh@gec.ac.in", department: "Mechanical", checkIn: "2025-11-05T08:05:00" }
                    ]
                },
                {
                    id: 4,
                    title: "AI & Machine Learning Workshop",
                    description: "Hands-on workshop on AI and ML concepts with practical implementation.",
                    category: "workshop",
                    date: "2025-10-30T10:00:00",
                    endDate: "2025-10-30T16:00:00",
                    location: "CS Lab 3",
                    organizer: "AI Club",
                    capacity: 50,
                    registered: 48,
                    image: "https://placehold.co/600x400/EC4899/FFFFFF?text=AI+Workshop",
                    status: "upcoming",
                    tags: ["ai", "machine learning", "hands-on"],
                    registrationDeadline: "2025-10-28T23:59:00",
                    isRegistered: false,
                    reminders: ["2025-10-29T10:00:00", "2025-10-30T09:00:00"],
                    facultyCoordinator: "Dr. Anjali Mehta",
                    participants: []
                },
                {
                    id: 5,
                    title: "Career Guidance Seminar",
                    description: "Expert advice on career paths, internships, and job opportunities.",
                    category: "academic",
                    date: "2025-10-20T14:00:00",
                    endDate: "2025-10-20T17:00:00",
                    location: "Seminar Hall",
                    organizer: "Placement Cell",
                    capacity: 200,
                    registered: 187,
                    image: "https://placehold.co/600x400/F59E0B/FFFFFF?text=Career+Seminar",
                    status: "upcoming",
                    tags: ["career", "guidance", "placement"],
                    registrationDeadline: "2025-10-19T23:59:00",
                    isRegistered: true,
                    reminders: ["2025-10-19T14:00:00", "2025-10-20T13:00:00"],
                    facultyCoordinator: "Dr. Ramesh Gupta",
                    participants: [
                        { id: 101, name: "Priya Sharma", email: "priya.sharma@gec.ac.in", department: "Computer Science", checkIn: null },
                        { id: 105, name: "Neha Verma", email: "neha.verma@gec.ac.in", department: "Electronics", checkIn: null }
                    ]
                },
                {
                    id: 6,
                    title: "Hackathon 2025",
                    description: "24-hour coding competition to solve real-world problems.",
                    category: "tech",
                    date: "2025-09-28T10:00:00",
                    endDate: "2025-09-29T10:00:00",
                    location: "Innovation Center",
                    organizer: "Coding Club",
                    capacity: 100,
                    registered: 100,
                    image: "https://placehold.co/600x400/3B82F6/FFFFFF?text=Hackathon",
                    status: "completed",
                    tags: ["coding", "competition", "innovation"],
                    registrationDeadline: "2025-09-25T23:59:00",
                    isRegistered: true,
                    reminders: [],
                    facultyCoordinator: "Dr. Sunita Patel",
                    participants: [
                        { id: 101, name: "Priya Sharma", email: "priya.sharma@gec.ac.in", department: "Computer Science", checkIn: "2025-09-28T10:10:00" },
                        { id: 102, name: "Rohan Mehra", email: "rohan.mehra@gec.ac.in", department: "Computer Science", checkIn: "2025-09-28T10:05:00" },
                        { id: 106, name: "Siddharth Rao", email: "siddharth.rao@gec.ac.in", department: "IT", checkIn: "2025-09-28T10:20:00" }
                    ]
                },
                {
                    id: 7,
                    title: "Music Concert",
                    description: "Live performance by popular college bands and solo artists.",
                    category: "cultural",
                    date: "2025-09-15T19:00:00",
                    endDate: "2025-09-15T22:00:00",
                    location: "Amphitheater",
                    organizer: "Music Club",
                    capacity: 500,
                    registered: 500,
                    image: "https://placehold.co/600x400/8B5CF6/FFFFFF?text=Music+Concert",
                    status: "completed",
                    tags: ["music", "live", "performance"],
                    registrationDeadline: "2025-09-14T23:59:00",
                    isRegistered: true,
                    reminders: [],
                    facultyCoordinator: "Dr. Anjali Mehta",
                    participants: [
                        { id: 101, name: "Priya Sharma", email: "priya.sharma@gec.ac.in", department: "Computer Science", checkIn: "2025-09-15T18:45:00" },
                        { id: 107, name: "Ananya Joshi", email: "ananya.joshi@gec.ac.in", department: "Civil", checkIn: "2025-09-15T19:10:00" }
                    ]
                }
            ],
            topicSuggestions: [
                {
                    id: 1,
                    title: "Blockchain Development Workshop",
                    description: "Learn the fundamentals of blockchain technology and smart contract development.",
                    category: "tech",
                    votes: 42,
                    submittedBy: "Aarav Sharma",
                    status: "under_review",
                    submittedOn: "2025-10-10T14:30:00"
                },
                {
                    id: 2,
                    title: "Mental Health Awareness Week",
                    description: "A series of sessions focused on mental wellness and stress management.",
                    category: "academic",
                    votes: 67,
                    submittedBy: "Kiara Patel",
                    status: "approved",
                    submittedOn: "2025-10-08T11:20:00"
                },
                {
                    id: 3,
                    title: "Entrepreneurship Summit",
                    description: "Connect with successful entrepreneurs and learn about startup ecosystems.",
                    category: "academic",
                    votes: 38,
                    submittedBy: "Rohan Mehra",
                    status: "under_review",
                    submittedOn: "2025-10-12T09:45:00"
                },
                {
                    id: 4,
                    title: "Photography Exhibition",
                    description: "Showcase your photography skills and participate in competitions.",
                    category: "cultural",
                    votes: 29,
                    submittedBy: "Diya Singh",
                    status: "rejected",
                    submittedOn: "2025-10-05T16:15:00",
                    rejectionReason: "Similar event already planned for next semester"
                }
            ],
            users: [
                { id: 101, name: "Priya Sharma", email: "priya.sharma@gec.ac.in", department: "Computer Science", role: "student", status: "active" },
                { id: 102, name: "Rohan Mehra", email: "rohan.mehra@gec.ac.in", department: "Computer Science", role: "student", status: "active" },
                { id: 103, name: "Aarav Kumar", email: "aarav.kumar@gec.ac.in", department: "IT", role: "student", status: "active" },
                { id: 104, name: "Vikram Singh", email: "vikram.singh@gec.ac.in", department: "Mechanical", role: "student", status: "active" },
                { id: 105, name: "Neha Verma", email: "neha.verma@gec.ac.in", department: "Electronics", role: "student", status: "active" },
                { id: 106, name: "Siddharth Rao", email: "siddharth.rao@gec.ac.in", department: "IT", role: "student", status: "active" },
                { id: 107, name: "Ananya Joshi", email: "ananya.joshi@gec.ac.in", department: "Civil", role: "student", status: "active" },
                { id: 201, name: "Dr. Ramesh Gupta", email: "ramesh.gupta@gec.ac.in", department: "Computer Science", role: "faculty", status: "active" },
                { id: 202, name: "Dr. Sunita Patel", email: "sunita.patel@gec.ac.in", department: "Cultural", role: "faculty", status: "active" },
                { id: 203, name: "Dr. Anjali Mehta", email: "anjali.mehta@gec.ac.in", department: "Administration", role: "admin", status: "active" }
            ],
            notifications: [
                {
                    id: 1,
                    text: "Reminder: Tech Fest starts tomorrow at 9 AM",
                    timestamp: "2025-11-14T09:00:00",
                    read: false,
                    type: "reminder"
                },
                {
                    id: 2,
                    text: "Your registration for Cultural Night is confirmed",
                    timestamp: "2025-10-20T14:30:00",
                    read: true,
                    type: "confirmation"
                },
                {
                    id: 3,
                    text: "New event: AI Workshop has been added",
                    timestamp: "2025-10-15T10:00:00",
                    read: true,
                    type: "new_event"
                }
            ]
        };

        let state = {
            isAuthenticated: false,
            currentRole: 'student',
            activeView: 'Dashboard',
            isSidebarOpen: window.innerWidth > 1024,
            studentData: mockData.student,
            facultyData: mockData.faculty,
            adminData: mockData.admin,
            events: mockData.events,
            topicSuggestions: mockData.topicSuggestions,
            users: mockData.users,
            notifications: mockData.notifications,
            showNotifications: false,
            eventFilter: 'all',
            searchQuery: '',
            selectedEvent: null,
            facultyTab: 'myEvents',
            adminTab: 'events'
        };

        // --- UTILITY & HELPER FUNCTIONS ---
        const formatDate = (dateString) => {
            const options = { 
                weekday: 'short', 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            return new Date(dateString).toLocaleDateString('en-US', options);
        };

        const formatTime = (dateString) => {
            return new Date(dateString).toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
        };

        const getDaysRemaining = (dateString) => {
            const eventDate = new Date(dateString);
            const today = new Date();
            const diffTime = eventDate - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays;
        };

        const getEventStatus = (event) => {
            const now = new Date();
            const startDate = new Date(event.date);
            const endDate = new Date(event.endDate);
            
            if (now < startDate) return 'upcoming';
            if (now >= startDate && now <= endDate) return 'ongoing';
            return 'completed';
        };

        const getCategoryColor = (category) => {
            const colors = {
                tech: 'bg-blue-100 text-blue-800',
                cultural: 'bg-purple-100 text-purple-800',
                sports: 'bg-green-100 text-green-800',
                academic: 'bg-yellow-100 text-yellow-800',
                workshop: 'bg-pink-100 text-pink-800'
            };
            return colors[category] || 'bg-gray-100 text-gray-800';
        };

        const getCategoryIcon = (category) => {
            const icons = {
                tech: 'cpu',
                cultural: 'music',
                sports: 'trophy',
                academic: 'graduation-cap',
                workshop: 'settings'
            };
            return icons[category] || 'calendar';
        };

        const showToast = (message, type = 'success') => {
            const toastContainer = document.getElementById('toast-container');
            const toast = document.createElement('div');
            const icon = type === 'success' ? `<i data-lucide="check-circle" class="text-green-500"></i>` : `<i data-lucide="alert-circle" class="text-red-500"></i>`;
            toast.className = `toast bg-white shadow-lg rounded-lg flex items-center p-4 border-l-4 ${type === 'success' ? 'border-green-500' : 'border-red-500'}`;
            toast.innerHTML = `${icon}<span class="ml-3 font-semibold text-gray-700">${message}</span>`;
            toastContainer.appendChild(toast);
            lucide.createIcons();
            setTimeout(() => toast.remove(), 3000);
        };

        const downloadICSFile = (event) => {
            const formatDate = (date) => {
                return date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
            }
            const startDate = new Date(event.date);
            const endDate = new Date(event.endDate);

            const icsContent = `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//CampusEventHub//EN
BEGIN:VEVENT
UID:${event.id}@campuseventhub
DTSTAMP:${formatDate(new Date())}
DTSTART:${formatDate(startDate)}
DTEND:${formatDate(endDate)}
SUMMARY:${event.title}
DESCRIPTION:${event.description}
LOCATION:${event.location}
END:VEVENT
END:VCALENDAR`;

            const blob = new Blob([icsContent], {type: 'text/calendar'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${event.title.replace(/\s+/g, '_')}.ics`;
            a.click();
            URL.revokeObjectURL(url);
            showToast("Calendar event added to your downloads.");
        };

        const downloadCSV = (data, filename) => {
            if (!data || data.length === 0) {
                alert('No data to download.');
                return;
            }
            const headers = Object.keys(data[0]);
            const csvRows = [
                headers.join(','),
                ...data.map(row => 
                    headers.map(header => JSON.stringify(row[header], (key, value) => value === null ? '' : value)).join(',')
                )
            ];
            const csvString = csvRows.join('\n');
            const blob = new Blob([csvString], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.setAttribute('hidden', '');
            a.setAttribute('href', url);
            a.setAttribute('download', `${filename}.csv`);
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        };

        // --- TEMPLATING / RENDERING FUNCTIONS ---
        const AppShell = (content) => `
            <div class="relative min-h-screen lg:flex">
                ${Sidebar()}
                <div id="main-content" class="flex-1 flex flex-col overflow-hidden smooth-transition ${state.isSidebarOpen ? 'lg:ml-64' : ''}">
                    ${Header()}
                    <main class="p-4 sm:p-6 lg:p-8 flex-1 overflow-y-auto">${content}</main>
                </div>
                <div id="mobile-overlay" class="fixed inset-0 bg-black/30 z-30 lg:hidden ${state.isSidebarOpen ? '' : 'hidden'}"></div>
            </div>
        `;
        
        const Sidebar = () => {
            const navItems = {
                student: [ 
                    { icon: 'layout-dashboard', label: 'Dashboard' }, 
                    { icon: 'calendar', label: 'All Events' }, 
                    { icon: 'user-check', label: 'My Events' }, 
                    { icon: 'lightbulb', label: 'Suggest Topics' },
                    { icon: 'user', label: 'Profile' }
                ],
                faculty: [ 
                    { icon: 'layout-dashboard', label: 'Dashboard' }, 
                    { icon: 'calendar', label: 'Event Management' }, 
                    { icon: 'users', label: 'Participant Management' },
                    { icon: 'bar-chart-3', label: 'Analytics' }
                ],
                admin: [ 
                    { icon: 'layout-dashboard', label: 'Dashboard' }, 
                    { icon: 'calendar', label: 'Event Management' }, 
                    { icon: 'lightbulb', label: 'Topic Suggestions' },
                    { icon: 'users', label: 'User Management' },
                    { icon: 'bar-chart-3', label: 'Analytics' }
                ],
            };
            const items = navItems[state.currentRole];
            return `<aside class="fixed inset-y-0 left-0 bg-white border-r border-gray-200 w-64 p-4 flex flex-col transform smooth-transition z-40 ${state.isSidebarOpen ? 'translate-x-0' : '-translate-x-full'}">
                <div class="text-2xl font-bold text-indigo-600 mb-8 px-2">Campus Event Hub</div>
                <nav class="flex-1 space-y-2">${items.map(item => `<button data-view="${item.label}" class="nav-button w-full flex items-center px-4 py-2.5 font-medium rounded-lg smooth-transition text-left ${state.activeView === item.label ? 'bg-indigo-50 text-indigo-600' : 'text-gray-600 hover:bg-gray-100 hover:translate-x-1'}"><i data-lucide="${item.icon}"></i><span class="ml-4">${item.label}</span></button>`).join('')}</nav>
                <div class="mt-auto"><button id="logout-button" class="w-full flex items-center px-4 py-2.5 text-gray-600 font-medium rounded-lg hover:bg-gray-100 smooth-transition"><i data-lucide="log-out"></i><span class="ml-4">Logout</span></button></div>
                <div class="mt-4 p-2 border-t"><label for="role-switcher" class="block text-xs font-medium text-gray-500 mb-2">Demo Role Switcher</label><select id="role-switcher" class="w-full p-2 border rounded-md text-sm"><option value="student" ${state.currentRole === 'student' ? 'selected' : ''}>Student</option><option value="faculty" ${state.currentRole === 'faculty' ? 'selected' : ''}>Faculty</option><option value="admin" ${state.currentRole === 'admin' ? 'selected' : ''}>Admin</option></select></div>
            </aside>`;
        };
        
        const Header = () => {
            const roleData = {
                student: { name: mockData.student.name, detail: "Student" },
                faculty: { name: mockData.faculty.name, detail: "Faculty Coordinator" },
                admin: { name: mockData.admin.name, detail: "Event Administrator" },
            };
            const currentData = roleData[state.currentRole];
            const unreadCount = state.notifications.filter(n => !n.read).length;

            return `<header class="bg-white/80 backdrop-blur-lg sticky top-0 z-20 p-4 sm:p-6 border-b border-gray-200">
                <div class="flex items-center justify-between">
                     <button id="menu-button" class="hamburger ${state.isSidebarOpen ? 'open' : ''}"><div class="hamburger-top"></div><div class="hamburger-middle"></div><div class="hamburger-bottom"></div></button>
                    <h1 class="text-xl font-semibold text-gray-800 ml-4 sm:ml-0">${state.activeView}</h1>
                    <div class="flex items-center space-x-4">
                        <div class="relative">
                            <button id="notification-bell" class="relative text-gray-600 hover:text-indigo-600 smooth-transition">
                                <i data-lucide="bell"></i>
                                ${unreadCount > 0 ? `<span class="absolute -top-2 -right-2 flex h-5 w-5 items-center justify-center rounded-full bg-red-500 text-xs font-bold text-white">${unreadCount}</span>` : ''}
                            </button>
                            <div id="notification-panel" class="absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-xl border p-4 z-50 ${state.showNotifications ? 'animate-fade-in' : 'hidden'}">
                                <div class="flex justify-between items-center mb-2">
                                    <h3 class="font-semibold">Notifications</h3>
                                    <button id="mark-all-read" class="text-xs text-indigo-600 hover:underline">Mark all as read</button>
                                </div>
                                <div class="max-h-96 overflow-y-auto divide-y">
                                    ${state.notifications.length > 0 ? state.notifications.map(n => `
                                        <div class="p-2 ${n.read ? 'opacity-60' : 'font-semibold'}">
                                            <p class="text-sm">${n.text}</p>
                                            <p class="text-xs text-gray-400 mt-1">${new Date(n.timestamp).toLocaleString()}</p>
                                        </div>
                                    `).join('') : '<p class="text-sm text-gray-500 text-center py-4">No new notifications.</p>'}
                                </div>
                            </div>
                        </div>
                        <div class="w-10 h-10 rounded-full bg-indigo-500 text-white flex items-center justify-center font-bold text-lg">${currentData.name.charAt(0)}</div>
                        <div class="hidden md:block"><p class="font-semibold text-gray-800 text-sm">${currentData.name}</p><p class="text-xs text-gray-500">${currentData.detail}</p></div>
                    </div>
                </div>
            </header>`;
        };

        const LoginPage = () => `<div class="w-full flex items-center justify-center min-h-screen p-4">
                <div class="w-full max-w-md p-8 space-y-8 bg-white rounded-2xl shadow-lg border animate-fade-in">
                    <div class="text-center"><h1 class="text-3xl font-bold text-indigo-600">Campus Event Hub</h1><p class="mt-2 text-gray-500">Sign in to access your dashboard</p></div>
                    <form id="login-form" class="space-y-6">
                        <div><label class="text-sm font-medium text-gray-700">I am a...</label><select id="login-role-select" class="w-full p-3 mt-1 border rounded-lg"><option value="student">Student</option><option value="faculty">Faculty</option><option value="admin">Admin</option></select></div>
                        <div><button type="submit" class="w-full py-3 font-semibold text-white bg-indigo-600 rounded-lg hover:bg-indigo-700 smooth-transition">Login</button></div>
                    </form>
                </div>
            </div>`;

        // Student Views
        const StudentDashboard = () => {
            const registeredEvents = state.events.filter(e => e.isRegistered);
            const upcomingEvents = state.events.filter(e => getEventStatus(e) === 'upcoming').slice(0, 3);
            const ongoingEvents = state.events.filter(e => getEventStatus(e) === 'ongoing');
            
            return `<div class="space-y-8 animate-fade-in">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border smooth-transition card-hover">
                        <div class="flex items-center">
                            <div class="p-3 rounded-lg bg-blue-100 text-blue-600"><i data-lucide="calendar"></i></div>
                            <div class="ml-4">
                                <p class="text-2xl font-bold text-gray-800">${registeredEvents.length}</p>
                                <p class="text-sm font-medium text-gray-500">Registered Events</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border smooth-transition card-hover">
                        <div class="flex items-center">
                            <div class="p-3 rounded-lg bg-green-100 text-green-600"><i data-lucide="clock"></i></div>
                            <div class="ml-4">
                                <p class="text-2xl font-bold text-gray-800">${upcomingEvents.length}</p>
                                <p class="text-sm font-medium text-gray-500">Upcoming Events</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border smooth-transition card-hover">
                        <div class="flex items-center">
                            <div class="p-3 rounded-lg bg-purple-100 text-purple-600"><i data-lucide="zap"></i></div>
                            <div class="ml-4">
                                <p class="text-2xl font-bold text-gray-800">${ongoingEvents.length}</p>
                                <p class="text-sm font-medium text-gray-500">Live Now</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                ${ongoingEvents.length > 0 ? `
                <div class="bg-white p-6 rounded-2xl shadow-sm border">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                        <i data-lucide="zap" class="mr-2 text-yellow-500"></i>Live Events Happening Now
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        ${ongoingEvents.map(event => `
                        <div class="event-card ${event.category} p-4 rounded-lg border smooth-transition card-hover">
                            <div class="flex justify-between items-start mb-2">
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getCategoryColor(event.category)}">
                                    <i data-lucide="${getCategoryIcon(event.category)}" class="w-3 h-3 mr-1"></i>
                                    ${event.category.charAt(0).toUpperCase() + event.category.slice(1)}
                                </span>
                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 pulse-live">
                                    <i data-lucide="circle" class="w-2 h-2 mr-1 fill-current"></i>
                                    LIVE
                                </span>
                            </div>
                            <h3 class="font-bold text-gray-800 mb-1">${event.title}</h3>
                            <p class="text-sm text-gray-600 mb-2 truncate">${event.description}</p>
                            <div class="flex items-center text-xs text-gray-500 mb-2">
                                <i data-lucide="map-pin" class="w-3 h-3 mr-1"></i>
                                <span>${event.location}</span>
                            </div>
                            <button data-event-id="${event.id}" class="view-event-details-btn w-full mt-2 bg-indigo-600 text-white text-sm font-semibold py-1.5 rounded-md hover:bg-indigo-700 smooth-transition">View Details</button>
                        </div>
                        `).join('')}
                    </div>
                </div>
                ` : ''}
                
                <div class="bg-white p-6 rounded-2xl shadow-sm border">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">Upcoming Events</h2>
                    <div class="space-y-4">
                        ${upcomingEvents.map(event => `
                        <div class="flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 smooth-transition">
                            <div class="flex items-center space-x-4">
                                <div class="flex-shrink-0 w-12 h-12 bg-indigo-100 rounded-lg flex items-center justify-center">
                                    <i data-lucide="${getCategoryIcon(event.category)}" class="text-indigo-600"></i>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-gray-800">${event.title}</h3>
                                    <p class="text-sm text-gray-500">${formatDate(event.date)} â€¢ ${event.location}</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="text-xs font-medium px-2 py-1 rounded-full ${getEventStatus(event) === 'upcoming' ? 'bg-blue-100 text-blue-800' : 'bg-green-100 text-green-800'}">
                                    ${getDaysRemaining(event.date)} days left
                                </span>
                                <button data-event-id="${event.id}" class="view-event-details-btn text-indigo-600 hover:text-indigo-800 smooth-transition">
                                    <i data-lucide="chevron-right"></i>
                                </button>
                            </div>
                        </div>
                        `).join('')}
                    </div>
                </div>
            </div>`;
        };

        const AllEventsView = () => {
            let filteredEvents = [...state.events];
            
            // Apply category filter
            if (state.eventFilter !== 'all') {
                filteredEvents = filteredEvents.filter(event => event.category === state.eventFilter);
            }
            
            // Apply search filter
            if (state.searchQuery) {
                const query = state.searchQuery.toLowerCase();
                filteredEvents = filteredEvents.filter(event => 
                    event.title.toLowerCase().includes(query) || 
                    event.description.toLowerCase().includes(query) ||
                    event.tags.some(tag => tag.toLowerCase().includes(query))
                );
            }
            
            const categories = [
                { id: 'all', name: 'All Events', icon: 'grid' },
                { id: 'tech', name: 'Technology', icon: 'cpu' },
                { id: 'cultural', name: 'Cultural', icon: 'music' },
                { id: 'sports', name: 'Sports', icon: 'trophy' },
                { id: 'academic', name: 'Academic', icon: 'graduation-cap' },
                { id: 'workshop', name: 'Workshop', icon: 'settings' }
            ];
            
            return `<div class="space-y-8 animate-fade-in">
                <div class="bg-white p-6 rounded-2xl shadow-sm border">
                    <div class="flex flex-col md:flex-row md:items-center justify-between mb-6">
                        <h2 class="text-xl font-semibold text-gray-800">All Events</h2>
                        <div class="mt-4 md:mt-0 flex space-x-4">
                            <div class="relative">
                                <i data-lucide="search" class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"></i>
                                <input type="text" id="event-search" placeholder="Search events..." class="pl-10 pr-4 py-2 border rounded-lg w-full md:w-64" value="${state.searchQuery}">
                            </div>
                            ${state.currentRole === 'faculty' || state.currentRole === 'admin' ? `
                            <button id="create-event-btn" class="flex items-center space-x-2 bg-indigo-600 text-white font-semibold px-4 py-2 rounded-lg hover:bg-indigo-700 smooth-transition">
                                <i data-lucide="plus-circle"></i>
                                <span>Create Event</span>
                            </button>
                            ` : ''}
                        </div>
                    </div>
                    
                    <div class="flex space-x-2 overflow-x-auto pb-2 mb-6">
                        ${categories.map(cat => `
                            <button data-category="${cat.id}" class="category-filter flex-shrink-0 flex items-center space-x-2 px-4 py-2 rounded-lg smooth-transition ${state.eventFilter === cat.id ? 'bg-indigo-100 text-indigo-700' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}">
                                <i data-lucide="${cat.icon}" class="w-4 h-4"></i>
                                <span>${cat.name}</span>
                            </button>
                        `).join('')}
                    </div>
                    
                    ${filteredEvents.length > 0 ? `
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        ${filteredEvents.map(event => {
                            const eventStatus = getEventStatus(event);
                            const daysRemaining = getDaysRemaining(event.date);
                            
                            return `
                            <div class="event-card ${event.category} p-6 rounded-2xl shadow-sm border smooth-transition card-hover">
                                <div class="flex justify-between items-start mb-4">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getCategoryColor(event.category)}">
                                        <i data-lucide="${getCategoryIcon(event.category)}" class="w-3 h-3 mr-1"></i>
                                        ${event.category.charAt(0).toUpperCase() + event.category.slice(1)}
                                    </span>
                                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${
                                        eventStatus === 'upcoming' ? 'bg-blue-100 text-blue-800' : 
                                        eventStatus === 'ongoing' ? 'bg-green-100 text-green-800 pulse-live' : 
                                        'bg-gray-100 text-gray-800'
                                    }">
                                        ${eventStatus === 'upcoming' ? `${daysRemaining} days left` : 
                                         eventStatus === 'ongoing' ? 'LIVE' : 'Completed'}
                                    </span>
                                </div>
                                
                                <img src="${event.image}" alt="${event.title}" class="w-full h-40 object-cover rounded-lg mb-4">
                                
                                <h3 class="font-bold text-lg text-gray-800 mb-2">${event.title}</h3>
                                <p class="text-sm text-gray-600 mb-4 line-clamp-2">${event.description}</p>
                                
                                <div class="space-y-2 mb-4">
                                    <div class="flex items-center text-sm text-gray-500">
                                        <i data-lucide="calendar" class="w-4 h-4 mr-2"></i>
                                        <span>${formatDate(event.date)}</span>
                                    </div>
                                    <div class="flex items-center text-sm text-gray-500">
                                        <i data-lucide="map-pin" class="w-4 h-4 mr-2"></i>
                                        <span>${event.location}</span>
                                    </div>
                                    <div class="flex items-center text-sm text-gray-500">
                                        <i data-lucide="users" class="w-4 h-4 mr-2"></i>
                                        <span>${event.registered} / ${event.capacity} registered</span>
                                    </div>
                                </div>
                                
                                <div class="flex space-x-2">
                                    <button data-event-id="${event.id}" class="view-event-details-btn flex-1 bg-indigo-600 text-white font-semibold py-2 rounded-lg hover:bg-indigo-700 smooth-transition">
                                        View Details
                                    </button>
                                    ${eventStatus !== 'completed' ? `
                                    <button data-event-id="${event.id}" class="add-to-calendar-btn p-2 border rounded-lg text-gray-600 hover:bg-gray-100 smooth-transition" title="Add to Calendar">
                                        <i data-lucide="calendar-plus"></i>
                                    </button>
                                    ` : ''}
                                </div>
                            </div>
                            `;
                        }).join('')}
                    </div>
                    ` : `
                    <div class="text-center py-12">
                        <i data-lucide="calendar-x" class="w-16 h-16 text-gray-300 mx-auto mb-4"></i>
                        <h3 class="text-lg font-medium text-gray-700">No events found</h3>
                        <p class="text-gray-500 mt-1">Try adjusting your search or filter criteria</p>
                    </div>
                    `}
                </div>
            </div>`;
        };

        const MyEventsView = () => {
            const registeredEvents = state.events.filter(e => e.isRegistered);
            const upcomingEvents = registeredEvents.filter(e => getEventStatus(e) === 'upcoming');
            const ongoingEvents = registeredEvents.filter(e => getEventStatus(e) === 'ongoing');
            const pastEvents = registeredEvents.filter(e => getEventStatus(e) === 'completed');
            
            return `<div class="space-y-8 animate-fade-in">
                <div class="bg-white p-6 rounded-2xl shadow-sm border">
                    <h2 class="text-xl font-semibold text-gray-800 mb-6">My Events</h2>
                    
                    ${upcomingEvents.length > 0 ? `
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold text-gray-700 mb-4 flex items-center">
                            <i data-lucide="clock" class="mr-2 text-blue-500"></i>Upcoming Events
                        </h3>
                        <div class="space-y-4">
                            ${upcomingEvents.map(event => `
                            <div class="flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 smooth-transition">
                                <div class="flex items-center space-x-4">
                                    <div class="flex-shrink-0 w-12 h-12 bg-indigo-100 rounded-lg flex items-center justify-center">
                                        <i data-lucide="${getCategoryIcon(event.category)}" class="text-indigo-600"></i>
                                    </div>
                                    <div>
                                        <h3 class="font-semibold text-gray-800">${event.title}</h3>
                                        <p class="text-sm text-gray-500">${formatDate(event.date)} â€¢ ${event.location}</p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="text-xs font-medium px-2 py-1 rounded-full bg-blue-100 text-blue-800">
                                        ${getDaysRemaining(event.date)} days left
                                    </span>
                                    <button data-event-id="${event.id}" class="view-event-details-btn text-indigo-600 hover:text-indigo-800 smooth-transition">
                                        <i data-lucide="chevron-right"></i>
                                    </button>
                                </div>
                            </div>
                            `).join('')}
                        </div>
                    </div>
                    ` : ''}
                    
                    ${ongoingEvents.length > 0 ? `
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold text-gray-700 mb-4 flex items-center">
                            <i data-lucide="zap" class="mr-2 text-green-500"></i>Live Events
                        </h3>
                        <div class="space-y-4">
                            ${ongoingEvents.map(event => `
                            <div class="flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 smooth-transition">
                                <div class="flex items-center space-x-4">
                                    <div class="flex-shrink-0 w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                                        <i data-lucide="${getCategoryIcon(event.category)}" class="text-green-600"></i>
                                    </div>
                                    <div>
                                        <h3 class="font-semibold text-gray-800">${event.title}</h3>
                                        <p class="text-sm text-gray-500">${formatDate(event.date)} â€¢ ${event.location}</p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="text-xs font-medium px-2 py-1 rounded-full bg-green-100 text-green-800 pulse-live">
                                        LIVE NOW
                                    </span>
                                    <button data-event-id="${event.id}" class="view-event-details-btn text-indigo-600 hover:text-indigo-800 smooth-transition">
                                        <i data-lucide="chevron-right"></i>
                                    </button>
                                </div>
                            </div>
                            `).join('')}
                        </div>
                    </div>
                    ` : ''}
                    
                    ${pastEvents.length > 0 ? `
                    <div>
                        <h3 class="text-lg font-semibold text-gray-700 mb-4 flex items-center">
                            <i data-lucide="check-circle" class="mr-2 text-gray-500"></i>Past Events
                        </h3>
                        <div class="space-y-4">
                            ${pastEvents.map(event => `
                            <div class="flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 smooth-transition">
                                <div class="flex items-center space-x-4">
                                    <div class="flex-shrink-0 w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center">
                                        <i data-lucide="${getCategoryIcon(event.category)}" class="text-gray-600"></i>
                                    </div>
                                    <div>
                                        <h3 class="font-semibold text-gray-800">${event.title}</h3>
                                        <p class="text-sm text-gray-500">${formatDate(event.date)} â€¢ ${event.location}</p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="text-xs font-medium px-2 py-1 rounded-full bg-gray-100 text-gray-800">
                                        Completed
                                    </span>
                                    <button data-event-id="${event.id}" class="view-event-details-btn text-indigo-600 hover:text-indigo-800 smooth-transition">
                                        <i data-lucide="chevron-right"></i>
                                    </button>
                                </div>
                            </div>
                            `).join('')}
                        </div>
                    </div>
                    ` : `
                    ${registeredEvents.length === 0 ? `
                    <div class="text-center py-12">
                        <i data-lucide="calendar" class="w-16 h-16 text-gray-300 mx-auto mb-4"></i>
                        <h3 class="text-lg font-medium text-gray-700">No registered events</h3>
                        <p class="text-gray-500 mt-1">Browse events and register to see them here</p>
                        <button data-view="All Events" class="nav-button mt-4 inline-flex items-center px-4 py-2 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 smooth-transition">
                            <i data-lucide="calendar" class="w-4 h-4 mr-2"></i>
                            Browse Events
                        </button>
                    </div>
                    ` : ''}
                    `}
                </div>
            </div>`;
        };

        const SuggestTopicsView = () => {
            const userSuggestions = state.topicSuggestions.filter(s => s.submittedBy === state.studentData.name);
            
            return `<div class="space-y-8 animate-fade-in">
                <div class="bg-white p-6 rounded-2xl shadow-sm border">
                    <h2 class="text-xl font-semibold text-gray-800 mb-6">Suggest Event Topics</h2>
                    
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold text-gray-700 mb-4">Submit a New Suggestion</h3>
                        <form id="suggestion-form" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Event Title</label>
                                <input type="text" name="title" class="w-full p-3 border rounded-lg" placeholder="Enter a catchy title for your event idea" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                <textarea name="description" rows="3" class="w-full p-3 border rounded-lg" placeholder="Describe your event idea in detail" required></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                                <select name="category" class="w-full p-3 border rounded-lg" required>
                                    <option value="">Select a category</option>
                                    <option value="tech">Technology</option>
                                    <option value="cultural">Cultural</option>
                                    <option value="sports">Sports</option>
                                    <option value="academic">Academic</option>
                                    <option value="workshop">Workshop</option>
                                </select>
                            </div>
                            <div>
                                <button type="submit" class="w-full bg-indigo-600 text-white font-semibold py-3 rounded-lg hover:bg-indigo-700 smooth-transition">Submit Suggestion</button>
                            </div>
                        </form>
                    </div>
                    
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold text-gray-700 mb-4">Community Suggestions</h3>
                        ${state.topicSuggestions.length > 0 ? `
                        <div class="space-y-4">
                            ${state.topicSuggestions.map(suggestion => `
                            <div class="p-4 border rounded-lg hover:bg-gray-50 smooth-transition">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-semibold text-gray-800">${suggestion.title}</h4>
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getCategoryColor(suggestion.category)}">
                                        ${suggestion.category.charAt(0).toUpperCase() + suggestion.category.slice(1)}
                                    </span>
                                </div>
                                <p class="text-sm text-gray-600 mb-3">${suggestion.description}</p>
                                <div class="flex justify-between items-center">
                                    <div class="flex items-center text-sm text-gray-500">
                                        <i data-lucide="user" class="w-4 h-4 mr-1"></i>
                                        <span>Submitted by ${suggestion.submittedBy}</span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <button data-suggestion-id="${suggestion.id}" class="vote-suggestion-btn flex items-center space-x-1 px-3 py-1 border rounded-lg text-gray-600 hover:bg-gray-100 smooth-transition">
                                            <i data-lucide="thumbs-up" class="w-4 h-4"></i>
                                            <span>${suggestion.votes}</span>
                                        </button>
                                        <span class="text-xs font-medium px-2 py-1 rounded-full ${
                                            suggestion.status === 'approved' ? 'bg-green-100 text-green-800' : 
                                            suggestion.status === 'rejected' ? 'bg-red-100 text-red-800' : 
                                            'bg-yellow-100 text-yellow-800'
                                        }">
                                            ${suggestion.status === 'approved' ? 'Approved' : 
                                             suggestion.status === 'rejected' ? 'Rejected' : 
                                             'Under Review'}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            `).join('')}
                        </div>
                        ` : `
                        <div class="text-center py-8">
                            <i data-lucide="lightbulb" class="w-12 h-12 text-gray-300 mx-auto mb-3"></i>
                            <p class="text-gray-500">No suggestions yet. Be the first to submit one!</p>
                        </div>
                        `}
                    </div>
                    
                    ${userSuggestions.length > 0 ? `
                    <div>
                        <h3 class="text-lg font-semibold text-gray-700 mb-4">My Suggestions</h3>
                        <div class="space-y-4">
                            ${userSuggestions.map(suggestion => `
                            <div class="p-4 border rounded-lg bg-gray-50">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-semibold text-gray-800">${suggestion.title}</h4>
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getCategoryColor(suggestion.category)}">
                                        ${suggestion.category.charAt(0).toUpperCase() + suggestion.category.slice(1)}
                                    </span>
                                </div>
                                <p class="text-sm text-gray-600 mb-3">${suggestion.description}</p>
                                <div class="flex justify-between items-center">
                                    <div class="text-sm text-gray-500">
                                        <span class="flex items-center">
                                            <i data-lucide="thumbs-up" class="w-4 h-4 mr-1"></i>
                                            ${suggestion.votes} votes
                                        </span>
                                    </div>
                                    <span class="text-xs font-medium px-2 py-1 rounded-full ${
                                        suggestion.status === 'approved' ? 'bg-green-100 text-green-800' : 
                                        suggestion.status === 'rejected' ? 'bg-red-100 text-red-800' : 
                                        'bg-yellow-100 text-yellow-800'
                                    }">
                                        ${suggestion.status === 'approved' ? 'Approved' : 
                                         suggestion.status === 'rejected' ? 'Rejected' : 
                                         'Under Review'}
                                    </span>
                                </div>
                            </div>
                            `).join('')}
                        </div>
                    </div>
                    ` : ''}
                </div>
            </div>`;
        };

        const StudentProfile = () => {
            const profile = state.studentData.profile;
            return `<div class="grid grid-cols-1 lg:grid-cols-3 gap-8 animate-fade-in">
                <div class="lg:col-span-2 space-y-6">
                    <div class="bg-white p-6 rounded-lg shadow-sm border">
                        <div class="flex flex-col sm:flex-row items-start justify-between">
                            <div class="flex items-center space-x-6">
                                <img src="${profile.profilePicUrl}" alt="${profile.name}" class="w-24 h-24 rounded-full border-4 border-white shadow-md"/>
                                <div>
                                    <h1 class="text-2xl font-bold text-gray-800">${profile.name}</h1>
                                    <p class="text-gray-600">${profile.headline}</p>
                                    <p class="text-sm text-gray-400 mt-1">${profile.department} â€¢ ${profile.year}</p>
                                </div>
                            </div>
                            <button id="edit-profile-btn" class="flex items-center space-x-2 border border-gray-300 text-gray-700 font-semibold px-4 py-2 rounded-lg hover:bg-gray-50 transition-colors text-sm mt-4 sm:mt-0">
                                <i data-lucide="edit" class="w-4 h-4"></i>
                                <span>Edit Profile</span>
                            </button>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-sm border">
                        <h2 class="text-xl font-semibold text-gray-800 mb-2">About</h2>
                        <p class="text-gray-600 whitespace-pre-wrap">${profile.about}</p>
                    </div>
                </div>
                <div class="space-y-6">
                    <div class="bg-white p-6 rounded-lg shadow-sm border">
                        <h2 class="text-xl font-semibold text-gray-800 mb-4">Interests</h2>
                        <div class="flex flex-wrap gap-2">
                            ${profile.interests.map(interest => `<span class="bg-gray-200 text-gray-800 text-sm font-medium px-3 py-1 rounded-full">${interest}</span>`).join('')}
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-sm border">
                        <h2 class="text-xl font-semibold text-gray-800 mb-4">Notification Preferences</h2>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <span class="text-gray-700">Event Reminders</span>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" class="sr-only peer" checked>
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"></div>
                                </label>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-700">New Events</span>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" class="sr-only peer" checked>
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"></div>
                                </label>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-700">Topic Suggestions Updates</span>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"></div>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>`;
        };

        // Event Details Modal
        const EventDetailsModal = (event) => {
            const eventStatus = getEventStatus(event);
            const daysRemaining = getDaysRemaining(event.date);
            const registrationClosed = new Date() > new Date(event.registrationDeadline);
            
            return `<div id="modal-overlay" class="fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center z-50 p-4">
                <div class="bg-white rounded-2xl shadow-xl w-full max-w-4xl p-6 sm:p-8 m-4 animate-fade-in max-h-[90vh] overflow-y-auto">
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getCategoryColor(event.category)} mb-2">
                                <i data-lucide="${getCategoryIcon(event.category)}" class="w-3 h-3 mr-1"></i>
                                ${event.category.charAt(0).toUpperCase() + event.category.slice(1)}
                            </span>
                            <h2 class="text-2xl font-bold text-gray-800">${event.title}</h2>
                            <div class="flex items-center flex-wrap gap-x-4 text-sm text-gray-500 mt-2">
                                <span class="flex items-center gap-x-1"><i data-lucide="calendar" class="w-4 h-4"></i> ${formatDate(event.date)}</span>
                                <span class="flex items-center gap-x-1"><i data-lucide="map-pin" class="w-4 h-4"></i> ${event.location}</span>
                                <span class="flex items-center gap-x-1"><i data-lucide="users" class="w-4 h-4"></i> ${event.registered} / ${event.capacity} registered</span>
                            </div>
                        </div>
                        <button id="close-modal-btn" class="text-gray-400 hover:text-gray-600"><i data-lucide="x"></i></button>
                    </div>
                    
                    <img src="${event.image}" alt="${event.title}" class="w-full h-64 object-cover rounded-lg mb-6">
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div class="lg:col-span-2">
                            <h3 class="text-lg font-semibold text-gray-800 mb-3">About this Event</h3>
                            <p class="text-gray-600 mb-6">${event.description}</p>
                            
                            <h3 class="text-lg font-semibold text-gray-800 mb-3">Event Tags</h3>
                            <div class="flex flex-wrap gap-2 mb-6">
                                ${event.tags.map(tag => `<span class="bg-gray-100 text-gray-800 text-xs font-medium px-2.5 py-0.5 rounded-full">${tag}</span>`).join('')}
                            </div>
                            
                            <h3 class="text-lg font-semibold text-gray-800 mb-3">Organizer</h3>
                            <p class="text-gray-600">${event.organizer}</p>
                        </div>
                        
                        <div class="space-y-4">
                            <div class="bg-gray-50 p-4 rounded-lg border">
                                <h4 class="font-semibold text-gray-800 mb-2">Event Status</h4>
                                <div class="flex items-center">
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${
                                        eventStatus === 'upcoming' ? 'bg-blue-100 text-blue-800' : 
                                        eventStatus === 'ongoing' ? 'bg-green-100 text-green-800' : 
                                        'bg-gray-100 text-gray-800'
                                    }">
                                        ${eventStatus === 'upcoming' ? `Starts in ${daysRemaining} days` : 
                                         eventStatus === 'ongoing' ? 'Happening Now' : 
                                         'Event Completed'}
                                    </span>
                                </div>
                            </div>
                            
                            ${eventStatus !== 'completed' ? `
                            <div class="bg-gray-50 p-4 rounded-lg border">
                                <h4 class="font-semibold text-gray-800 mb-2">Registration</h4>
                                ${registrationClosed ? `
                                <p class="text-sm text-red-600 mb-2">Registration closed on ${formatDate(event.registrationDeadline)}</p>
                                ` : `
                                <p class="text-sm text-gray-600 mb-2">Register before ${formatDate(event.registrationDeadline)}</p>
                                `}
                                
                                ${event.isRegistered ? `
                                <div class="space-y-2">
                                    <button class="w-full bg-green-100 text-green-800 font-semibold py-2 rounded-lg cursor-default">
                                        <i data-lucide="check-circle" class="w-4 h-4 inline mr-1"></i> Registered
                                    </button>
                                    <button data-event-id="${event.id}" class="w-full bg-red-100 text-red-800 font-semibold py-2 rounded-lg hover:bg-red-200 smooth-transition cancel-registration-btn">
                                        Cancel Registration
                                    </button>
                                </div>
                                ` : `
                                <button data-event-id="${event.id}" class="w-full bg-indigo-600 text-white font-semibold py-2 rounded-lg hover:bg-indigo-700 smooth-transition register-event-btn" ${registrationClosed || event.registered >= event.capacity ? 'disabled' : ''}>
                                    ${registrationClosed ? 'Registration Closed' : 
                                      event.registered >= event.capacity ? 'Event Full' : 
                                      'Register for Event'}
                                </button>
                                `}
                            </div>
                            ` : ''}
                            
                            <div class="bg-gray-50 p-4 rounded-lg border">
                                <h4 class="font-semibold text-gray-800 mb-2">Add to Calendar</h4>
                                <button data-event-id="${event.id}" class="w-full flex items-center justify-center space-x-2 bg-white border border-gray-300 text-gray-700 font-semibold py-2 rounded-lg hover:bg-gray-50 smooth-transition add-to-calendar-btn">
                                    <i data-lucide="calendar-plus" class="w-4 h-4"></i>
                                    <span>Download .ics file</span>
                                </button>
                            </div>
                            
                            ${event.reminders.length > 0 && event.isRegistered ? `
                            <div class="bg-gray-50 p-4 rounded-lg border">
                                <h4 class="font-semibold text-gray-800 mb-2">Reminders</h4>
                                <p class="text-sm text-gray-600">You'll receive reminders before the event:</p>
                                <ul class="text-sm text-gray-600 mt-1 space-y-1">
                                    ${event.reminders.map(reminder => `<li>â€¢ ${formatDate(reminder)}</li>`).join('')}
                                </ul>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
            </div>`;
        };

        // Faculty Views
        const FacultyDashboard = () => {
            const managedEvents = state.events.filter(e => state.facultyData.managedEvents.includes(e.id));
            const upcomingEvents = managedEvents.filter(e => getEventStatus(e) === 'upcoming');
            const ongoingEvents = managedEvents.filter(e => getEventStatus(e) === 'ongoing');
            const totalParticipants = managedEvents.reduce((sum, event) => sum + event.participants.length, 0);
            
            return `<div class="space-y-8 animate-fade-in">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border smooth-transition card-hover">
                        <div class="flex items-center">
                            <div class="p-3 rounded-lg bg-blue-100 text-blue-600"><i data-lucide="calendar"></i></div>
                            <div class="ml-4">
                                <p class="text-2xl font-bold text-gray-800">${managedEvents.length}</p>
                                <p class="text-sm font-medium text-gray-500">Managed Events</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border smooth-transition card-hover">
                        <div class="flex items-center">
                            <div class="p-3 rounded-lg bg-green-100 text-green-600"><i data-lucide="users"></i></div>
                            <div class="ml-4">
                                <p class="text-2xl font-bold text-gray-800">${totalParticipants}</p>
                                <p class="text-sm font-medium text-gray-500">Total Participants</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border smooth-transition card-hover">
                        <div class="flex items-center">
                            <div class="p-3 rounded-lg bg-purple-100 text-purple-600"><i data-lucide="zap"></i></div>
                            <div class="ml-4">
                                <p class="text-2xl font-bold text-gray-800">${ongoingEvents.length}</p>
                                <p class="text-sm font-medium text-gray-500">Live Events</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border smooth-transition card-hover">
                        <div class="flex items-center">
                            <div class="p-3 rounded-lg bg-yellow-100 text-yellow-600"><i data-lucide="clock"></i></div>
                            <div class="ml-4">
                                <p class="text-2xl font-bold text-gray-800">${upcomingEvents.length}</p>
                                <p class="text-sm font-medium text-gray-500">Upcoming Events</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border">
                        <h2 class="text-xl font-semibold text-gray-800 mb-4">Quick Actions</h2>
                        <div class="space-y-4">
                            <button id="create-event-btn" class="w-full flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 smooth-transition">
                                <div class="flex items-center">
                                    <div class="p-2 rounded-lg bg-indigo-100 text-indigo-600 mr-3">
                                        <i data-lucide="plus-circle"></i>
                                    </div>
                                    <div class="text-left">
                                        <p class="font-semibold text-gray-800">Create New Event</p>
                                        <p class="text-sm text-gray-500">Set up a new college event</p>
                                    </div>
                                </div>
                                <i data-lucide="chevron-right" class="text-gray-400"></i>
                            </button>
                            
                            <button data-view="Event Management" class="nav-button w-full flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 smooth-transition">
                                <div class="flex items-center">
                                    <div class="p-2 rounded-lg bg-green-100 text-green-600 mr-3">
                                        <i data-lucide="calendar"></i>
                                    </div>
                                    <div class="text-left">
                                        <p class="font-semibold text-gray-800">Manage Events</p>
                                        <p class="text-sm text-gray-500">View and edit your events</p>
                                    </div>
                                </div>
                                <i data-lucide="chevron-right" class="text-gray-400"></i>
                            </button>
                            
                            <button data-view="Participant Management" class="nav-button w-full flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 smooth-transition">
                                <div class="flex items-center">
                                    <div class="p-2 rounded-lg bg-blue-100 text-blue-600 mr-3">
                                        <i data-lucide="users"></i>
                                    </div>
                                    <div class="text-left">
                                        <p class="font-semibold text-gray-800">Participant Management</p>
                                        <p class="text-sm text-gray-500">Manage event participants</p>
                                    </div>
                                </div>
                                <i data-lucide="chevron-right" class="text-gray-400"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-2xl shadow-sm border">
                        <h2 class="text-xl font-semibold text-gray-800 mb-4">Recent Events</h2>
                        <div class="space-y-4">
                            ${managedEvents.slice(0, 3).map(event => {
                                const eventStatus = getEventStatus(event);
                                return `
                                <div class="flex items-center justify-between p-3 border rounded-lg">
                                    <div class="flex items-center space-x-3">
                                        <div class="flex-shrink-0 w-10 h-10 ${getCategoryColor(event.category)} rounded-lg flex items-center justify-center">
                                            <i data-lucide="${getCategoryIcon(event.category)}" class="w-4 h-4"></i>
                                        </div>
                                        <div>
                                            <p class="font-semibold text-gray-800">${event.title}</p>
                                            <p class="text-xs text-gray-500">${event.participants.length} participants</p>
                                        </div>
                                    </div>
                                    <span class="text-xs font-medium px-2 py-1 rounded-full ${
                                        eventStatus === 'upcoming' ? 'bg-blue-100 text-blue-800' : 
                                        eventStatus === 'ongoing' ? 'bg-green-100 text-green-800' : 
                                        'bg-gray-100 text-gray-800'
                                    }">
                                        ${eventStatus === 'upcoming' ? 'Upcoming' : 
                                         eventStatus === 'ongoing' ? 'Live' : 
                                         'Completed'}
                                    </span>
                                </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                </div>
            </div>`;
        };

        const FacultyEventManagement = () => {
            const managedEvents = state.events.filter(e => state.facultyData.managedEvents.includes(e.id));
            const activeTab = state.facultyTab || 'myEvents';
            
            const myEventsContent = `
                <div class="overflow-x-auto">
                    <table class="w-full text-left responsive-table">
                        <thead>
                            <tr class="text-sm text-gray-500 border-b">
                                <th class="py-3 px-4 font-medium">Event</th>
                                <th class="py-3 px-4 font-medium">Date</th>
                                <th class="py-3 px-4 font-medium text-center">Participants</th>
                                <th class="py-3 px-4 font-medium text-center">Status</th>
                                <th class="py-3 px-4 font-medium text-center">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${managedEvents.map(event => {
                                const eventStatus = getEventStatus(event);
                                return `
                                <tr class="border-b last:border-0 hover:bg-gray-50">
                                    <td data-label="Event" class="py-4 px-4">
                                        <div>
                                            <p class="font-semibold text-gray-800">${event.title}</p>
                                            <p class="text-sm text-gray-500">${event.category.charAt(0).toUpperCase() + event.category.slice(1)}</p>
                                        </div>
                                    </td>
                                    <td data-label="Date" class="py-4 px-4">${formatDate(event.date)}</td>
                                    <td data-label="Participants" class="py-4 px-4 text-center">${event.participants.length} / ${event.capacity}</td>
                                    <td data-label="Status" class="py-4 px-4 text-center">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
                                            eventStatus === 'upcoming' ? 'bg-blue-100 text-blue-800' : 
                                            eventStatus === 'ongoing' ? 'bg-green-100 text-green-800' : 
                                            'bg-gray-100 text-gray-800'
                                        }">
                                            ${eventStatus === 'upcoming' ? 'Upcoming' : 
                                             eventStatus === 'ongoing' ? 'Live' : 
                                             'Completed'}
                                        </span>
                                    </td>
                                    <td data-label="Actions" class="py-4 px-4 text-center">
                                        <div class="flex justify-center space-x-2">
                                            <button data-event-id="${event.id}" class="edit-event-btn p-1.5 text-blue-600 hover:bg-blue-50 rounded smooth-transition" title="Edit">
                                                <i data-lucide="edit" class="w-4 h-4"></i>
                                            </button>
                                            <button data-event-id="${event.id}" class="view-participants-btn p-1.5 text-green-600 hover:bg-green-50 rounded smooth-transition" title="Participants">
                                                <i data-lucide="users" class="w-4 h-4"></i>
                                            </button>
                                            <button data-event-id="${event.id}" class="delete-event-btn p-1.5 text-red-600 hover:bg-red-50 rounded smooth-transition" title="Delete">
                                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            const allEventsContent = `
                <div class="overflow-x-auto">
                    <table class="w-full text-left responsive-table">
                        <thead>
                            <tr class="text-sm text-gray-500 border-b">
                                <th class="py-3 px-4 font-medium">Event</th>
                                <th class="py-3 px-4 font-medium">Date</th>
                                <th class="py-3 px-4 font-medium">Organizer</th>
                                <th class="py-3 px-4 font-medium text-center">Participants</th>
                                <th class="py-3 px-4 font-medium text-center">Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${state.events.map(event => {
                                const eventStatus = getEventStatus(event);
                                return `
                                <tr class="border-b last:border-0 hover:bg-gray-50">
                                    <td data-label="Event" class="py-4 px-4">
                                        <div>
                                            <p class="font-semibold text-gray-800">${event.title}</p>
                                            <p class="text-sm text-gray-500">${event.category.charAt(0).toUpperCase() + event.category.slice(1)}</p>
                                        </div>
                                    </td>
                                    <td data-label="Date" class="py-4 px-4">${formatDate(event.date)}</td>
                                    <td data-label="Organizer" class="py-4 px-4">${event.organizer}</td>
                                    <td data-label="Participants" class="py-4 px-4 text-center">${event.registered} / ${event.capacity}</td>
                                    <td data-label="Status" class="py-4 px-4 text-center">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
                                            eventStatus === 'upcoming' ? 'bg-blue-100 text-blue-800' : 
                                            eventStatus === 'ongoing' ? 'bg-green-100 text-green-800' : 
                                            'bg-gray-100 text-gray-800'
                                        }">
                                            ${eventStatus === 'upcoming' ? 'Upcoming' : 
                                             eventStatus === 'ongoing' ? 'Live' : 
                                             'Completed'}
                                        </span>
                                    </td>
                                </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            return `<div class="space-y-8 animate-fade-in">
                <div class="bg-white p-6 rounded-2xl shadow-sm border">
                    <div class="flex flex-col md:flex-row md:items-center justify-between mb-6">
                        <h2 class="text-xl font-semibold text-gray-800">Event Management</h2>
                        <button id="create-event-btn" class="mt-4 md:mt-0 flex items-center space-x-2 bg-indigo-600 text-white font-semibold px-4 py-2 rounded-lg hover:bg-indigo-700 smooth-transition">
                            <i data-lucide="plus-circle"></i>
                            <span>Create Event</span>
                        </button>
                    </div>
                    
                    <div class="border-b border-gray-200">
                        <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                            <button data-tab="myEvents" class="faculty-tab-btn whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${activeTab === 'myEvents' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'}">My Events</button>
                            <button data-tab="allEvents" class="faculty-tab-btn whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${activeTab === 'allEvents' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'}">All College Events</button>
                        </nav>
                    </div>
                    
                    <div class="mt-6">
                        ${activeTab === 'myEvents' ? myEventsContent : allEventsContent}
                    </div>
                </div>
            </div>`;
        };

        const FacultyParticipantManagement = () => {
            const managedEvents = state.events.filter(e => state.facultyData.managedEvents.includes(e.id));
            
            return `<div class="space-y-8 animate-fade-in">
                <div class="bg-white p-6 rounded-2xl shadow-sm border">
                    <h2 class="text-xl font-semibold text-gray-800 mb-6">Participant Management</h2>
                    
                    <div class="space-y-6">
                        ${managedEvents.map(event => {
                            const checkedIn = event.participants.filter(p => p.checkIn !== null).length;
                            return `
                            <div class="border rounded-lg overflow-hidden">
                                <div class="bg-gray-50 px-4 py-3 border-b flex justify-between items-center">
                                    <div>
                                        <h3 class="font-semibold text-gray-800">${event.title}</h3>
                                        <p class="text-sm text-gray-500">${formatDate(event.date)} â€¢ ${event.location}</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-sm font-medium text-gray-700">${checkedIn} / ${event.participants.length} checked in</p>
                                        <p class="text-xs text-gray-500">${event.participants.length} total participants</p>
                                    </div>
                                </div>
                                <div class="overflow-x-auto">
                                    <table class="w-full text-left responsive-table">
                                        <thead>
                                            <tr class="text-sm text-gray-500 border-b">
                                                <th class="py-3 px-4 font-medium">Name</th>
                                                <th class="py-3 px-4 font-medium">Email</th>
                                                <th class="py-3 px-4 font-medium">Department</th>
                                                <th class="py-3 px-4 font-medium text-center">Check-in Status</th>
                                                <th class="py-3 px-4 font-medium text-center">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${event.participants.map(participant => `
                                            <tr class="border-b last:border-0 hover:bg-gray-50">
                                                <td data-label="Name" class="py-3 px-4 font-medium">${participant.name}</td>
                                                <td data-label="Email" class="py-3 px-4">${participant.email}</td>
                                                <td data-label="Department" class="py-3 px-4">${participant.department}</td>
                                                <td data-label="Check-in Status" class="py-3 px-4 text-center">
                                                    ${participant.checkIn ? 
                                                        `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                                            Checked in at ${formatTime(participant.checkIn)}
                                                        </span>` :
                                                        `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                                                            Not checked in
                                                        </span>`
                                                    }
                                                </td>
                                                <td data-label="Actions" class="py-3 px-4 text-center">
                                                    ${!participant.checkIn ? 
                                                        `<button data-event-id="${event.id}" data-participant-id="${participant.id}" class="check-in-btn bg-indigo-600 text-white text-xs font-semibold px-3 py-1.5 rounded-md hover:bg-indigo-700 smooth-transition">
                                                            Check In
                                                        </button>` :
                                                        `<button data-event-id="${event.id}" data-participant-id="${participant.id}" class="undo-check-in-btn bg-gray-600 text-white text-xs font-semibold px-3 py-1.5 rounded-md hover:bg-gray-700 smooth-transition">
                                                            Undo
                                                        </button>`
                                                    }
                                                </td>
                                            </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                </div>
                                ${event.participants.length === 0 ? 
                                `<div class="text-center py-8">
                                    <i data-lucide="users" class="w-12 h-12 text-gray-300 mx-auto mb-3"></i>
                                    <p class="text-gray-500">No participants registered for this event yet.</p>
                                </div>` : ''}
                            </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            </div>`;
        };

        const FacultyAnalytics = () => {
            const managedEvents = state.events.filter(e => state.facultyData.managedEvents.includes(e.id));
            const totalParticipants = managedEvents.reduce((sum, event) => sum + event.participants.length, 0);
            const checkedInParticipants = managedEvents.reduce((sum, event) => 
                sum + event.participants.filter(p => p.checkIn !== null).length, 0);
            
            // Calculate participation by department
            const departmentParticipation = {};
            managedEvents.forEach(event => {
                event.participants.forEach(participant => {
                    if (!departmentParticipation[participant.department]) {
                        departmentParticipation[participant.department] = 0;
                    }
                    departmentParticipation[participant.department]++;
                });
            });
            
            // Calculate event type distribution
            const eventTypeDistribution = {};
            managedEvents.forEach(event => {
                if (!eventTypeDistribution[event.category]) {
                    eventTypeDistribution[event.category] = 0;
                }
                eventTypeDistribution[event.category] += event.participants.length;
            });
            
            return `<div class="space-y-8 animate-fade-in">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border smooth-transition card-hover">
                        <div class="flex items-center">
                            <div class="p-3 rounded-lg bg-blue-100 text-blue-600"><i data-lucide="calendar"></i></div>
                            <div class="ml-4">
                                <p class="text-2xl font-bold text-gray-800">${managedEvents.length}</p>
                                <p class="text-sm font-medium text-gray-500">Total Events</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border smooth-transition card-hover">
                        <div class="flex items-center">
                            <div class="p-3 rounded-lg bg-green-100 text-green-600"><i data-lucide="users"></i></div>
                            <div class="ml-4">
                                <p class="text-2xl font-bold text-gray-800">${totalParticipants}</p>
                                <p class="text-sm font-medium text-gray-500">Total Participants</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border smooth-transition card-hover">
                        <div class="flex items-center">
                            <div class="p-3 rounded-lg bg-purple-100 text-purple-600"><i data-lucide="user-check"></i></div>
                            <div class="ml-4">
                                <p class="text-2xl font-bold text-gray-800">${checkedInParticipants}</p>
                                <p class="text-sm font-medium text-gray-500">Checked In</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border">
                        <h2 class="text-xl font-semibold text-gray-800 mb-4">Participation by Department</h2>
                        <div class="space-y-4">
                            ${Object.entries(departmentParticipation).map(([dept, count]) => {
                                const percentage = totalParticipants > 0 ? (count / totalParticipants * 100).toFixed(1) : 0;
                                return `
                                <div class="w-full">
                                    <div class="flex justify-between mb-1">
                                        <span class="text-base font-medium text-indigo-700">${dept}</span>
                                        <span class="text-sm font-medium text-indigo-700">${count} (${percentage}%)</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                                        <div class="bg-indigo-600 h-2.5 rounded-full smooth-transition" style="width: ${percentage}%"></div>
                                    </div>
                                </div>
                                `;
                            }).join('')}
                            ${Object.keys(departmentParticipation).length === 0 ? 
                            `<p class="text-gray-500 text-center py-4">No participation data available.</p>` : ''}
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-2xl shadow-sm border">
                        <h2 class="text-xl font-semibold text-gray-800 mb-4">Event Type Distribution</h2>
                        <div class="space-y-4">
                            ${Object.entries(eventTypeDistribution).map(([type, count]) => {
                                const percentage = totalParticipants > 0 ? (count / totalParticipants * 100).toFixed(1) : 0;
                                return `
                                <div class="w-full">
                                    <div class="flex justify-between mb-1">
                                        <span class="text-base font-medium ${getCategoryColor(type).split(' ')[1]}">${type.charAt(0).toUpperCase() + type.slice(1)}</span>
                                        <span class="text-sm font-medium ${getCategoryColor(type).split(' ')[1]}">${count} (${percentage}%)</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                                        <div class="h-2.5 rounded-full smooth-transition ${getCategoryColor(type).split(' ')[0]}" style="width: ${percentage}%"></div>
                                    </div>
                                </div>
                                `;
                            }).join('')}
                            ${Object.keys(eventTypeDistribution).length === 0 ? 
                            `<p class="text-gray-500 text-center py-4">No event type data available.</p>` : ''}
                        </div>
                    </div>
                </div>
                
                <div class="bg-white p-6 rounded-2xl shadow-sm border">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold text-gray-800">Event Reports</h2>
                        <button id="download-analytics-csv" class="flex items-center space-x-2 bg-gray-100 text-gray-800 font-semibold px-4 py-2 rounded-lg hover:bg-gray-200 smooth-transition">
                            <i data-lucide="download"></i>
                            <span>Export CSV</span>
                        </button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left responsive-table">
                            <thead>
                                <tr class="text-sm text-gray-500 border-b">
                                    <th class="py-3 px-4 font-medium">Event</th>
                                    <th class="py-3 px-4 font-medium">Date</th>
                                    <th class="py-3 px-4 font-medium text-center">Capacity</th>
                                    <th class="py-3 px-4 font-medium text-center">Registered</th>
                                    <th class="py-3 px-4 font-medium text-center">Checked In</th>
                                    <th class="py-3 px-4 font-medium text-center">Attendance Rate</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${managedEvents.map(event => {
                                    const checkedIn = event.participants.filter(p => p.checkIn !== null).length;
                                    const attendanceRate = event.participants.length > 0 ? 
                                        ((checkedIn / event.participants.length) * 100).toFixed(1) : 0;
                                    return `
                                    <tr class="border-b last:border-0 hover:bg-gray-50">
                                        <td data-label="Event" class="py-4 px-4 font-medium">${event.title}</td>
                                        <td data-label="Date" class="py-4 px-4">${formatDate(event.date)}</td>
                                        <td data-label="Capacity" class="py-4 px-4 text-center">${event.capacity}</td>
                                        <td data-label="Registered" class="py-4 px-4 text-center">${event.participants.length}</td>
                                        <td data-label="Checked In" class="py-4 px-4 text-center">${checkedIn}</td>
                                        <td data-label="Attendance Rate" class="py-4 px-4 text-center">
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
                                                attendanceRate >= 80 ? 'bg-green-100 text-green-800' :
                                                attendanceRate >= 50 ? 'bg-yellow-100 text-yellow-800' :
                                                'bg-red-100 text-red-800'
                                            }">
                                                ${attendanceRate}%
                                            </span>
                                        </td>
                                    </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>`;
        };

        // Admin Views
        const AdminDashboard = () => {
            const totalEvents = state.events.length;
            const totalUsers = state.users.length;
            const pendingSuggestions = state.topicSuggestions.filter(s => s.status === 'under_review').length;
            const upcomingEvents = state.events.filter(e => getEventStatus(e) === 'upcoming').length;
            
            return `<div class="space-y-8 animate-fade-in">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border smooth-transition card-hover">
                        <div class="flex items-center">
                            <div class="p-3 rounded-lg bg-blue-100 text-blue-600"><i data-lucide="calendar"></i></div>
                            <div class="ml-4">
                                <p class="text-2xl font-bold text-gray-800">${totalEvents}</p>
                                <p class="text-sm font-medium text-gray-500">Total Events</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border smooth-transition card-hover">
                        <div class="flex items-center">
                            <div class="p-3 rounded-lg bg-green-100 text-green-600"><i data-lucide="users"></i></div>
                            <div class="ml-4">
                                <p class="text-2xl font-bold text-gray-800">${totalUsers}</p>
                                <p class="text-sm font-medium text-gray-500">Total Users</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border smooth-transition card-hover">
                        <div class="flex items-center">
                            <div class="p-3 rounded-lg bg-purple-100 text-purple-600"><i data-lucide="lightbulb"></i></div>
                            <div class="ml-4">
                                <p class="text-2xl font-bold text-gray-800">${pendingSuggestions}</p>
                                <p class="text-sm font-medium text-gray-500">Pending Suggestions</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border smooth-transition card-hover">
                        <div class="flex items-center">
                            <div class="p-3 rounded-lg bg-yellow-100 text-yellow-600"><i data-lucide="clock"></i></div>
                            <div class="ml-4">
                                <p class="text-2xl font-bold text-gray-800">${upcomingEvents}</p>
                                <p class="text-sm font-medium text-gray-500">Upcoming Events</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border">
                        <h2 class="text-xl font-semibold text-gray-800 mb-4">Quick Actions</h2>
                        <div class="space-y-4">
                            <button id="create-event-btn" class="w-full flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 smooth-transition">
                                <div class="flex items-center">
                                    <div class="p-2 rounded-lg bg-indigo-100 text-indigo-600 mr-3">
                                        <i data-lucide="plus-circle"></i>
                                    </div>
                                    <div class="text-left">
                                        <p class="font-semibold text-gray-800">Create New Event</p>
                                        <p class="text-sm text-gray-500">Set up a new college event</p>
                                    </div>
                                </div>
                                <i data-lucide="chevron-right" class="text-gray-400"></i>
                            </button>
                            
                            <button data-view="Event Management" class="nav-button w-full flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 smooth-transition">
                                <div class="flex items-center">
                                    <div class="p-2 rounded-lg bg-green-100 text-green-600 mr-3">
                                        <i data-lucide="calendar"></i>
                                    </div>
                                    <div class="text-left">
                                        <p class="font-semibold text-gray-800">Manage Events</p>
                                        <p class="text-sm text-gray-500">View and edit all events</p>
                                    </div>
                                </div>
                                <i data-lucide="chevron-right" class="text-gray-400"></i>
                            </button>
                            
                            <button data-view="Topic Suggestions" class="nav-button w-full flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 smooth-transition">
                                <div class="flex items-center">
                                    <div class="p-2 rounded-lg bg-blue-100 text-blue-600 mr-3">
                                        <i data-lucide="lightbulb"></i>
                                    </div>
                                    <div class="text-left">
                                        <p class="font-semibold text-gray-800">Review Suggestions</p>
                                        <p class="text-sm text-gray-500">Approve or reject topic ideas</p>
                                    </div>
                                </div>
                                <i data-lucide="chevron-right" class="text-gray-400"></i>
                            </button>
                            
                            <button data-view="User Management" class="nav-button w-full flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 smooth-transition">
                                <div class="flex items-center">
                                    <div class="p-2 rounded-lg bg-purple-100 text-purple-600 mr-3">
                                        <i data-lucide="users"></i>
                                    </div>
                                    <div class="text-left">
                                        <p class="font-semibold text-gray-800">User Management</p>
                                        <p class="text-sm text-gray-500">Manage platform users</p>
                                    </div>
                                </div>
                                <i data-lucide="chevron-right" class="text-gray-400"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-2xl shadow-sm border">
                        <h2 class="text-xl font-semibold text-gray-800 mb-4">Recent Activity</h2>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between p-3 border rounded-lg">
                                <div class="flex items-center space-x-3">
                                    <div class="flex-shrink-0 w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                                        <i data-lucide="calendar" class="text-blue-600"></i>
                                    </div>
                                    <div>
                                        <p class="font-semibold text-gray-800">New Event Created</p>
                                        <p class="text-xs text-gray-500">Tech Fest by Computer Science Department</p>
                                    </div>
                                </div>
                                <span class="text-xs text-gray-400">2 hours ago</span>
                            </div>
                            
                            <div class="flex items-center justify-between p-3 border rounded-lg">
                                <div class="flex items-center space-x-3">
                                    <div class="flex-shrink-0 w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
                                        <i data-lucide="user-plus" class="text-green-600"></i>
                                    </div>
                                    <div>
                                        <p class="font-semibold text-gray-800">New User Registered</p>
                                        <p class="text-xs text-gray-500">Aarav Sharma joined the platform</p>
                                    </div>
                                </div>
                                <span class="text-xs text-gray-400">5 hours ago</span>
                            </div>
                            
                            <div class="flex items-center justify-between p-3 border rounded-lg">
                                <div class="flex items-center space-x-3">
                                    <div class="flex-shrink-0 w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
                                        <i data-lucide="lightbulb" class="text-purple-600"></i>
                                    </div>
                                    <div>
                                        <p class="font-semibold text-gray-800">Topic Suggestion Submitted</p>
                                        <p class="text-xs text-gray-500">Blockchain Workshop by Rohan Mehra</p>
                                    </div>
                                </div>
                                <span class="text-xs text-gray-400">1 day ago</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>`;
        };

        const AdminEventManagement = () => {
            const activeTab = state.adminTab || 'events';
            
            const eventsContent = `
                <div class="overflow-x-auto">
                    <table class="w-full text-left responsive-table">
                        <thead>
                            <tr class="text-sm text-gray-500 border-b">
                                <th class="py-3 px-4 font-medium">Event</th>
                                <th class="py-3 px-4 font-medium">Date</th>
                                <th class="py-3 px-4 font-medium">Organizer</th>
                                <th class="py-3 px-4 font-medium">Coordinator</th>
                                <th class="py-3 px-4 font-medium text-center">Participants</th>
                                <th class="py-3 px-4 font-medium text-center">Status</th>
                                <th class="py-3 px-4 font-medium text-center">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${state.events.map(event => {
                                const eventStatus = getEventStatus(event);
                                return `
                                <tr class="border-b last:border-0 hover:bg-gray-50">
                                    <td data-label="Event" class="py-4 px-4">
                                        <div>
                                            <p class="font-semibold text-gray-800">${event.title}</p>
                                            <p class="text-sm text-gray-500">${event.category.charAt(0).toUpperCase() + event.category.slice(1)}</p>
                                        </div>
                                    </td>
                                    <td data-label="Date" class="py-4 px-4">${formatDate(event.date)}</td>
                                    <td data-label="Organizer" class="py-4 px-4">${event.organizer}</td>
                                    <td data-label="Coordinator" class="py-4 px-4">${event.facultyCoordinator}</td>
                                    <td data-label="Participants" class="py-4 px-4 text-center">${event.registered} / ${event.capacity}</td>
                                    <td data-label="Status" class="py-4 px-4 text-center">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
                                            eventStatus === 'upcoming' ? 'bg-blue-100 text-blue-800' : 
                                            eventStatus === 'ongoing' ? 'bg-green-100 text-green-800' : 
                                            'bg-gray-100 text-gray-800'
                                        }">
                                            ${eventStatus === 'upcoming' ? 'Upcoming' : 
                                             eventStatus === 'ongoing' ? 'Live' : 
                                             'Completed'}
                                        </span>
                                    </td>
                                    <td data-label="Actions" class="py-4 px-4 text-center">
                                        <div class="flex justify-center space-x-2">
                                            <button data-event-id="${event.id}" class="edit-event-btn p-1.5 text-blue-600 hover:bg-blue-50 rounded smooth-transition" title="Edit">
                                                <i data-lucide="edit" class="w-4 h-4"></i>
                                            </button>
                                            <button data-event-id="${event.id}" class="view-participants-btn p-1.5 text-green-600 hover:bg-green-50 rounded smooth-transition" title="Participants">
                                                <i data-lucide="users" class="w-4 h-4"></i>
                                            </button>
                                            <button data-event-id="${event.id}" class="delete-event-btn p-1.5 text-red-600 hover:bg-red-50 rounded smooth-transition" title="Delete">
                                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            const categoriesContent = `
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="border rounded-lg p-6 text-center smooth-transition card-hover">
                        <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i data-lucide="cpu" class="w-8 h-8 text-blue-600"></i>
                        </div>
                        <h3 class="font-semibold text-gray-800 mb-2">Technology</h3>
                        <p class="text-sm text-gray-600 mb-4">Coding competitions, tech talks, workshops</p>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-500">Events:</span>
                            <span class="font-semibold">${state.events.filter(e => e.category === 'tech').length}</span>
                        </div>
                    </div>
                    
                    <div class="border rounded-lg p-6 text-center smooth-transition card-hover">
                        <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i data-lucide="music" class="w-8 h-8 text-purple-600"></i>
                        </div>
                        <h3 class="font-semibold text-gray-800 mb-2">Cultural</h3>
                        <p class="text-sm text-gray-600 mb-4">Music, dance, performances, exhibitions</p>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-500">Events:</span>
                            <span class="font-semibold">${state.events.filter(e => e.category === 'cultural').length}</span>
                        </div>
                    </div>
                    
                    <div class="border rounded-lg p-6 text-center smooth-transition card-hover">
                        <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i data-lucide="trophy" class="w-8 h-8 text-green-600"></i>
                        </div>
                        <h3 class="font-semibold text-gray-800 mb-2">Sports</h3>
                        <p class="text-sm text-gray-600 mb-4">Tournaments, matches, fitness events</p>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-500">Events:</span>
                            <span class="font-semibold">${state.events.filter(e => e.category === 'sports').length}</span>
                        </div>
                    </div>
                    
                    <div class="border rounded-lg p-6 text-center smooth-transition card-hover">
                        <div class="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i data-lucide="graduation-cap" class="w-8 h-8 text-yellow-600"></i>
                        </div>
                        <h3 class="font-semibold text-gray-800 mb-2">Academic</h3>
                        <p class="text-sm text-gray-600 mb-4">Seminars, lectures, career guidance</p>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-500">Events:</span>
                            <span class="font-semibold">${state.events.filter(e => e.category === 'academic').length}</span>
                        </div>
                    </div>
                    
                    <div class="border rounded-lg p-6 text-center smooth-transition card-hover">
                        <div class="w-16 h-16 bg-pink-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i data-lucide="settings" class="w-8 h-8 text-pink-600"></i>
                        </div>
                        <h3 class="font-semibold text-gray-800 mb-2">Workshop</h3>
                        <p class="text-sm text-gray-600 mb-4">Hands-on sessions, skill development</p>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-500">Events:</span>
                            <span class="font-semibold">${state.events.filter(e => e.category === 'workshop').length}</span>
                        </div>
                    </div>
                    
                    <div class="border rounded-lg p-6 text-center smooth-transition card-hover">
                        <div class="w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i data-lucide="plus" class="w-8 h-8 text-indigo-600"></i>
                        </div>
                        <h3 class="font-semibold text-gray-800 mb-2">Add New Category</h3>
                        <p class="text-sm text-gray-600 mb-4">Create a custom event category</p>
                        <button class="w-full bg-indigo-600 text-white font-semibold py-2 rounded-lg hover:bg-indigo-700 smooth-transition">
                            Add Category
                        </button>
                    </div>
                </div>
            `;
            
            return `<div class="space-y-8 animate-fade-in">
                <div class="bg-white p-6 rounded-2xl shadow-sm border">
                    <div class="flex flex-col md:flex-row md:items-center justify-between mb-6">
                        <h2 class="text-xl font-semibold text-gray-800">Event Management</h2>
                        <button id="create-event-btn" class="mt-4 md:mt-0 flex items-center space-x-2 bg-indigo-600 text-white font-semibold px-4 py-2 rounded-lg hover:bg-indigo-700 smooth-transition">
                            <i data-lucide="plus-circle"></i>
                            <span>Create Event</span>
                        </button>
                    </div>
                    
                    <div class="border-b border-gray-200">
                        <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                            <button data-tab="events" class="admin-tab-btn whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${activeTab === 'events' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'}">All Events</button>
                            <button data-tab="categories" class="admin-tab-btn whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${activeTab === 'categories' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'}">Event Categories</button>
                        </nav>
                    </div>
                    
                    <div class="mt-6">
                        ${activeTab === 'events' ? eventsContent : categoriesContent}
                    </div>
                </div>
            </div>`;
        };

        const AdminTopicSuggestions = () => {
            const pendingSuggestions = state.topicSuggestions.filter(s => s.status === 'under_review');
            const approvedSuggestions = state.topicSuggestions.filter(s => s.status === 'approved');
            const rejectedSuggestions = state.topicSuggestions.filter(s => s.status === 'rejected');
            
            return `<div class="space-y-8 animate-fade-in">
                <div class="bg-white p-6 rounded-2xl shadow-sm border">
                    <h2 class="text-xl font-semibold text-gray-800 mb-6">Topic Suggestions Management</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                            <div class="flex items-center">
                                <div class="p-2 rounded-lg bg-blue-100 text-blue-600 mr-3">
                                    <i data-lucide="clock"></i>
                                </div>
                                <div>
                                    <p class="text-2xl font-bold text-blue-800">${pendingSuggestions.length}</p>
                                    <p class="text-sm font-medium text-blue-600">Pending Review</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                            <div class="flex items-center">
                                <div class="p-2 rounded-lg bg-green-100 text-green-600 mr-3">
                                    <i data-lucide="check-circle"></i>
                                </div>
                                <div>
                                    <p class="text-2xl font-bold text-green-800">${approvedSuggestions.length}</p>
                                    <p class="text-sm font-medium text-green-600">Approved</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-red-50 p-4 rounded-lg border border-red-200">
                            <div class="flex items-center">
                                <div class="p-2 rounded-lg bg-red-100 text-red-600 mr-3">
                                    <i data-lucide="x-circle"></i>
                                </div>
                                <div>
                                    <p class="text-2xl font-bold text-red-800">${rejectedSuggestions.length}</p>
                                    <p class="text-sm font-medium text-red-600">Rejected</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="space-y-6">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-700 mb-4">Pending Review</h3>
                            ${pendingSuggestions.length > 0 ? `
                            <div class="space-y-4">
                                ${pendingSuggestions.map(suggestion => `
                                <div class="p-4 border rounded-lg hover:bg-gray-50 smooth-transition">
                                    <div class="flex justify-between items-start mb-2">
                                        <h4 class="font-semibold text-gray-800">${suggestion.title}</h4>
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getCategoryColor(suggestion.category)}">
                                            ${suggestion.category.charAt(0).toUpperCase() + suggestion.category.slice(1)}
                                        </span>
                                    </div>
                                    <p class="text-sm text-gray-600 mb-3">${suggestion.description}</p>
                                    <div class="flex justify-between items-center">
                                        <div class="flex items-center text-sm text-gray-500">
                                            <i data-lucide="user" class="w-4 h-4 mr-1"></i>
                                            <span>Submitted by ${suggestion.submittedBy}</span>
                                            <span class="mx-2">â€¢</span>
                                            <i data-lucide="thumbs-up" class="w-4 h-4 mr-1"></i>
                                            <span>${suggestion.votes} votes</span>
                                        </div>
                                        <div class="flex space-x-2">
                                            <button data-suggestion-id="${suggestion.id}" data-action="approve" class="suggestion-action-btn bg-green-600 text-white text-xs font-semibold px-3 py-1.5 rounded-md hover:bg-green-700 smooth-transition">
                                                Approve
                                            </button>
                                            <button data-suggestion-id="${suggestion.id}" data-action="reject" class="suggestion-action-btn bg-red-600 text-white text-xs font-semibold px-3 py-1.5 rounded-md hover:bg-red-700 smooth-transition">
                                                Reject
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                `).join('')}
                            </div>
                            ` : `
                            <div class="text-center py-8">
                                <i data-lucide="check-circle" class="w-12 h-12 text-green-300 mx-auto mb-3"></i>
                                <p class="text-gray-500">No pending suggestions to review.</p>
                            </div>
                            `}
                        </div>
                        
                        <div>
                            <h3 class="text-lg font-semibold text-gray-700 mb-4">Approved Suggestions</h3>
                            ${approvedSuggestions.length > 0 ? `
                            <div class="space-y-4">
                                ${approvedSuggestions.map(suggestion => `
                                <div class="p-4 border rounded-lg bg-green-50">
                                    <div class="flex justify-between items-start mb-2">
                                        <h4 class="font-semibold text-gray-800">${suggestion.title}</h4>
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                            Approved
                                        </span>
                                    </div>
                                    <p class="text-sm text-gray-600 mb-3">${suggestion.description}</p>
                                    <div class="flex justify-between items-center">
                                        <div class="text-sm text-gray-500">
                                            <span class="flex items-center">
                                                <i data-lucide="user" class="w-4 h-4 mr-1"></i>
                                                Submitted by ${suggestion.submittedBy}
                                            </span>
                                        </div>
                                        <button data-suggestion-id="${suggestion.id}" class="create-event-from-suggestion-btn bg-indigo-600 text-white text-xs font-semibold px-3 py-1.5 rounded-md hover:bg-indigo-700 smooth-transition">
                                            Create Event
                                        </button>
                                    </div>
                                </div>
                                `).join('')}
                            </div>
                            ` : `
                            <div class="text-center py-8">
                                <i data-lucide="lightbulb" class="w-12 h-12 text-gray-300 mx-auto mb-3"></i>
                                <p class="text-gray-500">No approved suggestions yet.</p>
                            </div>
                            `}
                        </div>
                        
                        <div>
                            <h3 class="text-lg font-semibold text-gray-700 mb-4">Rejected Suggestions</h3>
                            ${rejectedSuggestions.length > 0 ? `
                            <div class="space-y-4">
                                ${rejectedSuggestions.map(suggestion => `
                                <div class="p-4 border rounded-lg bg-red-50">
                                    <div class="flex justify-between items-start mb-2">
                                        <h4 class="font-semibold text-gray-800">${suggestion.title}</h4>
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                            Rejected
                                        </span>
                                    </div>
                                    <p class="text-sm text-gray-600 mb-3">${suggestion.description}</p>
                                    ${suggestion.rejectionReason ? `
                                    <div class="bg-white p-3 rounded border text-sm text-gray-600 mb-3">
                                        <strong>Reason for rejection:</strong> ${suggestion.rejectionReason}
                                    </div>
                                    ` : ''}
                                    <div class="text-sm text-gray-500">
                                        <span class="flex items-center">
                                            <i data-lucide="user" class="w-4 h-4 mr-1"></i>
                                            Submitted by ${suggestion.submittedBy}
                                        </span>
                                    </div>
                                </div>
                                `).join('')}
                            </div>
                            ` : `
                            <div class="text-center py-8">
                                <i data-lucide="thumbs-up" class="w-12 h-12 text-gray-300 mx-auto mb-3"></i>
                                <p class="text-gray-500">No rejected suggestions.</p>
                            </div>
                            `}
                        </div>
                    </div>
                </div>
            </div>`;
        };

        const AdminUserManagement = () => {
            const students = state.users.filter(u => u.role === 'student');
            const faculty = state.users.filter(u => u.role === 'faculty');
            const admins = state.users.filter(u => u.role === 'admin');
            
            return `<div class="space-y-8 animate-fade-in">
                <div class="bg-white p-6 rounded-2xl shadow-sm border">
                    <div class="flex flex-col md:flex-row md:items-center justify-between mb-6">
                        <h2 class="text-xl font-semibold text-gray-800">User Management</h2>
                        <button id="add-user-btn" class="mt-4 md:mt-0 flex items-center space-x-2 bg-indigo-600 text-white font-semibold px-4 py-2 rounded-lg hover:bg-indigo-700 smooth-transition">
                            <i data-lucide="user-plus"></i>
                            <span>Add User</span>
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                            <div class="flex items-center">
                                <div class="p-2 rounded-lg bg-blue-100 text-blue-600 mr-3">
                                    <i data-lucide="users"></i>
                                </div>
                                <div>
                                    <p class="text-2xl font-bold text-blue-800">${students.length}</p>
                                    <p class="text-sm font-medium text-blue-600">Students</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                            <div class="flex items-center">
                                <div class="p-2 rounded-lg bg-green-100 text-green-600 mr-3">
                                    <i data-lucide="user-check"></i>
                                </div>
                                <div>
                                    <p class="text-2xl font-bold text-green-800">${faculty.length}</p>
                                    <p class="text-sm font-medium text-green-600">Faculty</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
                            <div class="flex items-center">
                                <div class="p-2 rounded-lg bg-purple-100 text-purple-600 mr-3">
                                    <i data-lucide="shield"></i>
                                </div>
                                <div>
                                    <p class="text-2xl font-bold text-purple-800">${admins.length}</p>
                                    <p class="text-sm font-medium text-purple-600">Administrators</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="space-y-6">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-700 mb-4">Students</h3>
                            <div class="overflow-x-auto">
                                <table class="w-full text-left responsive-table">
                                    <thead>
                                        <tr class="text-sm text-gray-500 border-b">
                                            <th class="py-3 px-4 font-medium">Name</th>
                                            <th class="py-3 px-4 font-medium">Email</th>
                                            <th class="py-3 px-4 font-medium">Department</th>
                                            <th class="py-3 px-4 font-medium text-center">Status</th>
                                            <th class="py-3 px-4 font-medium text-center">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${students.map(user => `
                                        <tr class="border-b last:border-0 hover:bg-gray-50">
                                            <td data-label="Name" class="py-4 px-4 font-medium">${user.name}</td>
                                            <td data-label="Email" class="py-4 px-4">${user.email}</td>
                                            <td data-label="Department" class="py-4 px-4">${user.department}</td>
                                            <td data-label="Status" class="py-4 px-4 text-center">
                                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                                    ${user.status}
                                                </span>
                                            </td>
                                            <td data-label="Actions" class="py-4 px-4 text-center">
                                                <div class="flex justify-center space-x-2">
                                                    <button data-user-id="${user.id}" class="edit-user-btn p-1.5 text-blue-600 hover:bg-blue-50 rounded smooth-transition" title="Edit">
                                                        <i data-lucide="edit" class="w-4 h-4"></i>
                                                    </button>
                                                    <button data-user-id="${user.id}" class="deactivate-user-btn p-1.5 text-red-600 hover:bg-red-50 rounded smooth-transition" title="Deactivate">
                                                        <i data-lucide="user-x" class="w-4 h-4"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="text-lg font-semibold text-gray-700 mb-4">Faculty</h3>
                            <div class="overflow-x-auto">
                                <table class="w-full text-left responsive-table">
                                    <thead>
                                        <tr class="text-sm text-gray-500 border-b">
                                            <th class="py-3 px-4 font-medium">Name</th>
                                            <th class="py-3 px-4 font-medium">Email</th>
                                            <th class="py-3 px-4 font-medium">Department</th>
                                            <th class="py-3 px-4 font-medium text-center">Status</th>
                                            <th class="py-3 px-4 font-medium text-center">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${faculty.map(user => `
                                        <tr class="border-b last:border-0 hover:bg-gray-50">
                                            <td data-label="Name" class="py-4 px-4 font-medium">${user.name}</td>
                                            <td data-label="Email" class="py-4 px-4">${user.email}</td>
                                            <td data-label="Department" class="py-4 px-4">${user.department}</td>
                                            <td data-label="Status" class="py-4 px-4 text-center">
                                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                                    ${user.status}
                                                </span>
                                            </td>
                                            <td data-label="Actions" class="py-4 px-4 text-center">
                                                <div class="flex justify-center space-x-2">
                                                    <button data-user-id="${user.id}" class="edit-user-btn p-1.5 text-blue-600 hover:bg-blue-50 rounded smooth-transition" title="Edit">
                                                        <i data-lucide="edit" class="w-4 h-4"></i>
                                                    </button>
                                                    <button data-user-id="${user.id}" class="deactivate-user-btn p-1.5 text-red-600 hover:bg-red-50 rounded smooth-transition" title="Deactivate">
                                                        <i data-lucide="user-x" class="w-4 h-4"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="text-lg font-semibold text-gray-700 mb-4">Administrators</h3>
                            <div class="overflow-x-auto">
                                <table class="w-full text-left responsive-table">
                                    <thead>
                                        <tr class="text-sm text-gray-500 border-b">
                                            <th class="py-3 px-4 font-medium">Name</th>
                                            <th class="py-3 px-4 font-medium">Email</th>
                                            <th class="py-3 px-4 font-medium">Department</th>
                                            <th class="py-3 px-4 font-medium text-center">Status</th>
                                            <th class="py-3 px-4 font-medium text-center">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${admins.map(user => `
                                        <tr class="border-b last:border-0 hover:bg-gray-50">
                                            <td data-label="Name" class="py-4 px-4 font-medium">${user.name}</td>
                                            <td data-label="Email" class="py-4 px-4">${user.email}</td>
                                            <td data-label="Department" class="py-4 px-4">${user.department}</td>
                                            <td data-label="Status" class="py-4 px-4 text-center">
                                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                                    ${user.status}
                                                </span>
                                            </td>
                                            <td data-label="Actions" class="py-4 px-4 text-center">
                                                <div class="flex justify-center space-x-2">
                                                    <button data-user-id="${user.id}" class="edit-user-btn p-1.5 text-blue-600 hover:bg-blue-50 rounded smooth-transition" title="Edit">
                                                        <i data-lucide="edit" class="w-4 h-4"></i>
                                                    </button>
                                                    ${user.id !== 203 ? `<button data-user-id="${user.id}" class="deactivate-user-btn p-1.5 text-red-600 hover:bg-red-50 rounded smooth-transition" title="Deactivate">
                                                        <i data-lucide="user-x" class="w-4 h-4"></i>
                                                    </button>` : ''}
                                                </div>
                                            </td>
                                        </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>`;
        };

        const AdminAnalytics = () => {
            const totalEvents = state.events.length;
            const totalParticipants = state.events.reduce((sum, event) => sum + event.participants.length, 0);
            const upcomingEvents = state.events.filter(e => getEventStatus(e) === 'upcoming').length;
            const completedEvents = state.events.filter(e => getEventStatus(e) === 'completed').length;
            
            // Calculate event distribution by category
            const eventDistribution = {};
            state.events.forEach(event => {
                if (!eventDistribution[event.category]) {
                    eventDistribution[event.category] = 0;
                }
                eventDistribution[event.category]++;
            });
            
            // Calculate participation by department
            const departmentParticipation = {};
            state.events.forEach(event => {
                event.participants.forEach(participant => {
                    if (!departmentParticipation[participant.department]) {
                        departmentParticipation[participant.department] = 0;
                    }
                    departmentParticipation[participant.department]++;
                });
            });
            
            // Calculate user distribution by role
            const userDistribution = {
                student: state.users.filter(u => u.role === 'student').length,
                faculty: state.users.filter(u => u.role === 'faculty').length,
                admin: state.users.filter(u => u.role === 'admin').length
            };
            
            return `<div class="space-y-8 animate-fade-in">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border smooth-transition card-hover">
                        <div class="flex items-center">
                            <div class="p-3 rounded-lg bg-blue-100 text-blue-600"><i data-lucide="calendar"></i></div>
                            <div class="ml-4">
                                <p class="text-2xl font-bold text-gray-800">${totalEvents}</p>
                                <p class="text-sm font-medium text-gray-500">Total Events</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border smooth-transition card-hover">
                        <div class="flex items-center">
                            <div class="p-3 rounded-lg bg-green-100 text-green-600"><i data-lucide="users"></i></div>
                            <div class="ml-4">
                                <p class="text-2xl font-bold text-gray-800">${totalParticipants}</p>
                                <p class="text-sm font-medium text-gray-500">Total Participants</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border smooth-transition card-hover">
                        <div class="flex items-center">
                            <div class="p-3 rounded-lg bg-purple-100 text-purple-600"><i data-lucide="user-check"></i></div>
                            <div class="ml-4">
                                <p class="text-2xl font-bold text-gray-800">${state.users.length}</p>
                                <p class="text-sm font-medium text-gray-500">Total Users</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border smooth-transition card-hover">
                        <div class="flex items-center">
                            <div class="p-3 rounded-lg bg-yellow-100 text-yellow-600"><i data-lucide="trending-up"></i></div>
                            <div class="ml-4">
                                <p class="text-2xl font-bold text-gray-800">${upcomingEvents}</p>
                                <p class="text-sm font-medium text-gray-500">Upcoming Events</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border">
                        <h2 class="text-xl font-semibold text-gray-800 mb-4">Event Distribution by Category</h2>
                        <div class="space-y-4">
                            ${Object.entries(eventDistribution).map(([category, count]) => {
                                const percentage = totalEvents > 0 ? (count / totalEvents * 100).toFixed(1) : 0;
                                return `
                                <div class="w-full">
                                    <div class="flex justify-between mb-1">
                                        <span class="text-base font-medium ${getCategoryColor(category).split(' ')[1]}">${category.charAt(0).toUpperCase() + category.slice(1)}</span>
                                        <span class="text-sm font-medium ${getCategoryColor(category).split(' ')[1]}">${count} (${percentage}%)</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                                        <div class="h-2.5 rounded-full smooth-transition ${getCategoryColor(category).split(' ')[0]}" style="width: ${percentage}%"></div>
                                    </div>
                                </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-2xl shadow-sm border">
                        <h2 class="text-xl font-semibold text-gray-800 mb-4">User Distribution by Role</h2>
                        <div class="space-y-4">
                            <div class="w-full">
                                <div class="flex justify-between mb-1">
                                    <span class="text-base font-medium text-blue-700">Students</span>
                                    <span class="text-sm font-medium text-blue-700">${userDistribution.student} (${((userDistribution.student / state.users.length) * 100).toFixed(1)}%)</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2.5">
                                    <div class="bg-blue-600 h-2.5 rounded-full smooth-transition" style="width: ${(userDistribution.student / state.users.length) * 100}%"></div>
                                </div>
                            </div>
                            <div class="w-full">
                                <div class="flex justify-between mb-1">
                                    <span class="text-base font-medium text-green-700">Faculty</span>
                                    <span class="text-sm font-medium text-green-700">${userDistribution.faculty} (${((userDistribution.faculty / state.users.length) * 100).toFixed(1)}%)</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2.5">
                                    <div class="bg-green-600 h-2.5 rounded-full smooth-transition" style="width: ${(userDistribution.faculty / state.users.length) * 100}%"></div>
                                </div>
                            </div>
                            <div class="w-full">
                                <div class="flex justify-between mb-1">
                                    <span class="text-base font-medium text-purple-700">Administrators</span>
                                    <span class="text-sm font-medium text-purple-700">${userDistribution.admin} (${((userDistribution.admin / state.users.length) * 100).toFixed(1)}%)</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2.5">
                                    <div class="bg-purple-600 h-2.5 rounded-full smooth-transition" style="width: ${(userDistribution.admin / state.users.length) * 100}%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white p-6 rounded-2xl shadow-sm border">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold text-gray-800">Platform Reports</h2>
                        <div class="flex space-x-2">
                            <button id="download-events-csv" class="flex items-center space-x-2 bg-gray-100 text-gray-800 font-semibold px-4 py-2 rounded-lg hover:bg-gray-200 smooth-transition">
                                <i data-lucide="download"></i>
                                <span>Events CSV</span>
                            </button>
                            <button id="download-users-csv" class="flex items-center space-x-2 bg-gray-100 text-gray-800 font-semibold px-4 py-2 rounded-lg hover:bg-gray-200 smooth-transition">
                                <i data-lucide="download"></i>
                                <span>Users CSV</span>
                            </button>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left responsive-table">
                            <thead>
                                <tr class="text-sm text-gray-500 border-b">
                                    <th class="py-3 px-4 font-medium">Metric</th>
                                    <th class="py-3 px-4 font-medium text-center">Count</th>
                                    <th class="py-3 px-4 font-medium text-center">Percentage</th>
                                    <th class="py-3 px-4 font-medium">Trend</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="border-b last:border-0 hover:bg-gray-50">
                                    <td data-label="Metric" class="py-4 px-4 font-medium">Total Events</td>
                                    <td data-label="Count" class="py-4 px-4 text-center">${totalEvents}</td>
                                    <td data-label="Percentage" class="py-4 px-4 text-center">100%</td>
                                    <td data-label="Trend" class="py-4 px-4">
                                        <div class="flex items-center text-green-600">
                                            <i data-lucide="trending-up" class="w-4 h-4 mr-1"></i>
                                            <span>12% increase</span>
                                        </div>
                                    </td>
                                </tr>
                                <tr class="border-b last:border-0 hover:bg-gray-50">
                                    <td data-label="Metric" class="py-4 px-4 font-medium">Upcoming Events</td>
                                    <td data-label="Count" class="py-4 px-4 text-center">${upcomingEvents}</td>
                                    <td data-label="Percentage" class="py-4 px-4 text-center">${((upcomingEvents / totalEvents) * 100).toFixed(1)}%</td>
                                    <td data-label="Trend" class="py-4 px-4">
                                        <div class="flex items-center text-blue-600">
                                            <i data-lucide="clock" class="w-4 h-4 mr-1"></i>
                                            <span>Scheduled</span>
                                        </div>
                                    </td>
                                </tr>
                                <tr class="border-b last:border-0 hover:bg-gray-50">
                                    <td data-label="Metric" class="py-4 px-4 font-medium">Completed Events</td>
                                    <td data-label="Count" class="py-4 px-4 text-center">${completedEvents}</td>
                                    <td data-label="Percentage" class="py-4 px-4 text-center">${((completedEvents / totalEvents) * 100).toFixed(1)}%</td>
                                    <td data-label="Trend" class="py-4 px-4">
                                        <div class="flex items-center text-gray-600">
                                            <i data-lucide="check-circle" class="w-4 h-4 mr-1"></i>
                                            <span>Completed</span>
                                        </div>
                                    </td>
                                </tr>
                                <tr class="border-b last:border-0 hover:bg-gray-50">
                                    <td data-label="Metric" class="py-4 px-4 font-medium">Total Participants</td>
                                    <td data-label="Count" class="py-4 px-4 text-center">${totalParticipants}</td>
                                    <td data-label="Percentage" class="py-4 px-4 text-center">-</td>
                                    <td data-label="Trend" class="py-4 px-4">
                                        <div class="flex items-center text-green-600">
                                            <i data-lucide="trending-up" class="w-4 h-4 mr-1"></i>
                                            <span>18% increase</span>
                                        </div>
                                    </td>
                                </tr>
                                <tr class="border-b last:border-0 hover:bg-gray-50">
                                    <td data-label="Metric" class="py-4 px-4 font-medium">Active Users</td>
                                    <td data-label="Count" class="py-4 px-4 text-center">${state.users.length}</td>
                                    <td data-label="Percentage" class="py-4 px-4 text-center">100%</td>
                                    <td data-label="Trend" class="py-4 px-4">
                                        <div class="flex items-center text-green-600">
                                            <i data-lucide="trending-up" class="w-4 h-4 mr-1"></i>
                                            <span>8% increase</span>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>`;
        };

        // Form Modal Component
        const FormModal = (title, formContent, handleSubmit) => {
            const modalId = 'form-modal-container';
            const modalHTML = `<div id="${modalId}" class="fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center z-50 p-4"><div class="bg-white rounded-2xl shadow-xl w-full max-w-2xl p-6 sm:p-8 animate-fade-in max-h-[90vh] overflow-y-auto"><div class="flex justify-between items-center mb-6"><h2 class="text-2xl font-bold text-gray-800">${title}</h2><button class="close-modal-btn text-gray-400 hover:text-gray-600"><i data-lucide="x"></i></button></div><form id="generic-form" class="space-y-4">${formContent}<div class="flex justify-end space-x-4 pt-4"><button type="button" class="close-modal-btn px-6 py-2 rounded-lg bg-gray-100 hover:bg-gray-200">Cancel</button><button type="submit" class="px-6 py-2 rounded-lg text-white bg-indigo-600 hover:bg-indigo-700">Save Changes</button></div></form></div></div>`;
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            lucide.createIcons();
            const closeModal = () => document.getElementById(modalId)?.remove();
            document.querySelectorAll('.close-modal-btn').forEach(btn => btn.addEventListener('click', closeModal));
            document.getElementById('generic-form').addEventListener('submit', (e) => { e.preventDefault(); handleSubmit(new FormData(e.target)); closeModal(); });
        };

        // --- ROUTER & MAIN RENDER FUNCTION ---
        function render() {
            const appContainer = document.getElementById('app-container');
            if (!state.isAuthenticated) { 
                appContainer.innerHTML = LoginPage(); 
                addLoginListeners(); 
                lucide.createIcons(); 
                return; 
            }
            
            let viewContent = '';
            switch(state.currentRole) {
                case 'student': 
                    viewContent = state.activeView === 'Dashboard' ? StudentDashboard() : 
                                 state.activeView === 'All Events' ? AllEventsView() : 
                                 state.activeView === 'My Events' ? MyEventsView() : 
                                 state.activeView === 'Suggest Topics' ? SuggestTopicsView() : 
                                 state.activeView === 'Profile' ? StudentProfile() : 
                                 StudentDashboard(); 
                    break;
                case 'faculty': 
                    viewContent = state.activeView === 'Dashboard' ? FacultyDashboard() : 
                                 state.activeView === 'Event Management' ? FacultyEventManagement() : 
                                 state.activeView === 'Participant Management' ? FacultyParticipantManagement() : 
                                 state.activeView === 'Analytics' ? FacultyAnalytics() : 
                                 FacultyDashboard(); 
                    break;
                case 'admin': 
                    viewContent = state.activeView === 'Dashboard' ? AdminDashboard() : 
                                 state.activeView === 'Event Management' ? AdminEventManagement() : 
                                 state.activeView === 'Topic Suggestions' ? AdminTopicSuggestions() : 
                                 state.activeView === 'User Management' ? AdminUserManagement() : 
                                 state.activeView === 'Analytics' ? AdminAnalytics() : 
                                 AdminDashboard(); 
                    break;
            }
            appContainer.innerHTML = AppShell(viewContent);
            addAppListeners();
            lucide.createIcons();
        }

        // --- EVENT LISTENERS ---
        function addLoginListeners() {
            document.getElementById('login-form').addEventListener('submit', (e) => { 
                e.preventDefault(); 
                const role = document.getElementById('login-role-select').value; 
                state.isAuthenticated = true; 
                state.currentRole = role; 
                state.activeView = 'Dashboard'; 
                render(); 
            });
        }
        
        function addAppListeners() {
            document.getElementById('logout-button')?.addEventListener('click', () => { 
                state.isAuthenticated = false; 
                render(); 
            });
            
            document.getElementById('role-switcher')?.addEventListener('change', (e) => { 
                state.currentRole = e.target.value; 
                state.activeView = 'Dashboard'; 
                render(); 
            });
            
            document.querySelectorAll('.nav-button').forEach(button => { 
                button.addEventListener('click', () => { 
                    state.activeView = button.dataset.view; 
                    if(window.innerWidth < 1024) state.isSidebarOpen = false; 
                    render(); 
                }); 
            });
            
            document.getElementById('menu-button')?.addEventListener('click', () => { 
                state.isSidebarOpen = !state.isSidebarOpen; 
                render(); 
            });
            
            document.getElementById('mobile-overlay')?.addEventListener('click', () => { 
                state.isSidebarOpen = false; 
                render(); 
            });
            
            // Notification panel
            document.getElementById('notification-bell')?.addEventListener('click', () => {
                state.showNotifications = !state.showNotifications;
                render();
            });
            
            document.getElementById('mark-all-read')?.addEventListener('click', () => {
                state.notifications.forEach(n => n.read = true);
                state.showNotifications = false;
                render();
            });
            
            // Event category filters
            document.querySelectorAll('.category-filter').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    state.eventFilter = e.currentTarget.dataset.category;
                    render();
                });
            });
            
            // Event search
            document.getElementById('event-search')?.addEventListener('input', (e) => {
                state.searchQuery = e.target.value;
                // We could add debouncing here for better performance
                render();
            });
            
            // View event details
            document.querySelectorAll('.view-event-details-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const eventId = parseInt(e.currentTarget.dataset.eventId);
                    const event = state.events.find(e => e.id === eventId);
                    if (event) {
                        const modalContainer = document.createElement('div');
                        modalContainer.id = 'modal-container';
                        modalContainer.innerHTML = EventDetailsModal(event);
                        document.body.appendChild(modalContainer);
                        lucide.createIcons();
                        
                        const closeModal = () => document.getElementById('modal-container')?.remove();
                        document.getElementById('close-modal-btn').addEventListener('click', closeModal);
                        document.getElementById('modal-overlay').addEventListener('click', (event) => {
                            if (event.target.id === 'modal-overlay') closeModal();
                        });
                        
                        // Register for event
                        document.querySelector('.register-event-btn')?.addEventListener('click', (e) => {
                            const eventId = parseInt(e.currentTarget.dataset.eventId);
                            const event = state.events.find(e => e.id === eventId);
                            if (event && event.registered < event.capacity) {
                                event.isRegistered = true;
                                event.registered++;
                                showToast(`Successfully registered for ${event.title}!`);
                                closeModal();
                                render();
                            }
                        });
                        
                        // Cancel registration
                        document.querySelector('.cancel-registration-btn')?.addEventListener('click', (e) => {
                            const eventId = parseInt(e.currentTarget.dataset.eventId);
                            const event = state.events.find(e => e.id === eventId);
                            if (event) {
                                event.isRegistered = false;
                                event.registered--;
                                showToast(`Registration cancelled for ${event.title}`);
                                closeModal();
                                render();
                            }
                        });
                        
                        // Add to calendar
                        document.querySelector('.add-to-calendar-btn')?.addEventListener('click', (e) => {
                            const eventId = parseInt(e.currentTarget.dataset.eventId);
                            const event = state.events.find(e => e.id === eventId);
                            if (event) {
                                downloadICSFile(event);
                            }
                        });
                    }
                });
            });
            
            // Add to calendar from event cards
            document.querySelectorAll('.add-to-calendar-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const eventId = parseInt(e.currentTarget.dataset.eventId);
                    const event = state.events.find(e => e.id === eventId);
                    if (event) {
                        downloadICSFile(event);
                    }
                });
            });
            
            // Submit topic suggestion
            document.getElementById('suggestion-form')?.addEventListener('submit', (e) => {
                e.preventDefault();
                const formData = new FormData(e.target);
                const newSuggestion = {
                    id: state.topicSuggestions.length + 1,
                    title: formData.get('title'),
                    description: formData.get('description'),
                    category: formData.get('category'),
                    votes: 1,
                    submittedBy: state.studentData.name,
                    status: 'under_review',
                    submittedOn: new Date().toISOString()
                };
                state.topicSuggestions.unshift(newSuggestion);
                showToast('Your suggestion has been submitted!');
                e.target.reset();
                render();
            });
            
            // Vote for suggestions
            document.querySelectorAll('.vote-suggestion-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const suggestionId = parseInt(e.currentTarget.dataset.suggestionId);
                    const suggestion = state.topicSuggestions.find(s => s.id === suggestionId);
                    if (suggestion) {
                        suggestion.votes++;
                        showToast('Thanks for your vote!');
                        render();
                    }
                });
            });
            
            // Edit profile
            document.getElementById('edit-profile-btn')?.addEventListener('click', () => {
                const profile = state.studentData.profile;
                const formContent = `
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Name</label>
                            <input type="text" name="name" class="w-full p-2 border rounded-md" value="${profile.name}">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Headline</label>
                            <input type="text" name="headline" class="w-full p-2 border rounded-md" value="${profile.headline}">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">About</label>
                            <textarea name="about" rows="4" class="w-full p-2 border rounded-md">${profile.about}</textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Interests (comma-separated)</label>
                            <input type="text" name="interests" class="w-full p-2 border rounded-md" value="${profile.interests.join(', ')}">
                        </div>
                    </div>
                `;
                FormModal("Edit Profile", formContent, (formData) => { 
                    state.studentData.profile.name = formData.get('name'); 
                    state.studentData.profile.headline = formData.get('headline'); 
                    state.studentData.profile.about = formData.get('about'); 
                    state.studentData.profile.interests = formData.get('interests').split(',').map(s => s.trim()); 
                    showToast("Profile updated successfully!");
                    render(); 
                });
            });
            
            // Faculty tab navigation
            document.querySelectorAll('.faculty-tab-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    state.facultyTab = e.target.dataset.tab;
                    render();
                });
            });
            
            // Admin tab navigation
            document.querySelectorAll('.admin-tab-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    state.adminTab = e.target.dataset.tab;
                    render();
                });
            });
            
            // Create event functionality (for faculty and admin)
            document.querySelectorAll('#create-event-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const formContent = `
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Event Title</label>
                                <input type="text" name="title" class="w-full p-2 border rounded-md" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Description</label>
                                <textarea name="description" rows="3" class="w-full p-2 border rounded-md" required></textarea>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Category</label>
                                    <select name="category" class="w-full p-2 border rounded-md" required>
                                        <option value="tech">Technology</option>
                                        <option value="cultural">Cultural</option>
                                        <option value="sports">Sports</option>
                                        <option value="academic">Academic</option>
                                        <option value="workshop">Workshop</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Capacity</label>
                                    <input type="number" name="capacity" class="w-full p-2 border rounded-md" required>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Start Date & Time</label>
                                    <input type="datetime-local" name="date" class="w-full p-2 border rounded-md" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">End Date & Time</label>
                                    <input type="datetime-local" name="endDate" class="w-full p-2 border rounded-md" required>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Location</label>
                                <input type="text" name="location" class="w-full p-2 border rounded-md" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Organizer</label>
                                <input type="text" name="organizer" class="w-full p-2 border rounded-md" required>
                            </div>
                            ${state.currentRole === 'admin' ? `
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Faculty Coordinator</label>
                                <select name="facultyCoordinator" class="w-full p-2 border rounded-md" required>
                                    <option value="Dr. Ramesh Gupta">Dr. Ramesh Gupta</option>
                                    <option value="Dr. Sunita Patel">Dr. Sunita Patel</option>
                                    <option value="Dr. Anjali Mehta">Dr. Anjali Mehta</option>
                                </select>
                            </div>
                            ` : ''}
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Tags (comma-separated)</label>
                                <input type="text" name="tags" class="w-full p-2 border rounded-md" placeholder="e.g., coding, workshop, competition">
                            </div>
                        </div>
                    `;
                    FormModal("Create New Event", formContent, (formData) => {
                        const newEvent = {
                            id: state.events.length + 1,
                            title: formData.get('title'),
                            description: formData.get('description'),
                            category: formData.get('category'),
                            date: formData.get('date'),
                            endDate: formData.get('endDate'),
                            location: formData.get('location'),
                            organizer: formData.get('organizer'),
                            capacity: parseInt(formData.get('capacity')),
                            registered: 0,
                            image: `https://placehold.co/600x400/3B82F6/FFFFFF?text=${encodeURIComponent(formData.get('title'))}`,
                            status: 'upcoming',
                            tags: formData.get('tags') ? formData.get('tags').split(',').map(s => s.trim()) : [],
                            registrationDeadline: new Date(new Date(formData.get('date')).getTime() - 24 * 60 * 60 * 1000).toISOString(),
                            isRegistered: false,
                            reminders: [],
                            facultyCoordinator: state.currentRole === 'admin' ? formData.get('facultyCoordinator') : state.facultyData.name,
                            participants: []
                        };
                        state.events.unshift(newEvent);
                        
                        // If faculty created the event, add it to their managed events
                        if (state.currentRole === 'faculty') {
                            state.facultyData.managedEvents.push(newEvent.id);
                        }
                        
                        showToast("Event created successfully!");
                        render();
                    });
                });
            });
            
            // Edit event functionality
            document.querySelectorAll('.edit-event-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const eventId = parseInt(e.currentTarget.dataset.eventId);
                    const event = state.events.find(e => e.id === eventId);
                    if (event) {
                        const formContent = `
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Event Title</label>
                                    <input type="text" name="title" class="w-full p-2 border rounded-md" value="${event.title}" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Description</label>
                                    <textarea name="description" rows="3" class="w-full p-2 border rounded-md" required>${event.description}</textarea>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Category</label>
                                        <select name="category" class="w-full p-2 border rounded-md" required>
                                            <option value="tech" ${event.category === 'tech' ? 'selected' : ''}>Technology</option>
                                            <option value="cultural" ${event.category === 'cultural' ? 'selected' : ''}>Cultural</option>
                                            <option value="sports" ${event.category === 'sports' ? 'selected' : ''}>Sports</option>
                                            <option value="academic" ${event.category === 'academic' ? 'selected' : ''}>Academic</option>
                                            <option value="workshop" ${event.category === 'workshop' ? 'selected' : ''}>Workshop</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Capacity</label>
                                        <input type="number" name="capacity" class="w-full p-2 border rounded-md" value="${event.capacity}" required>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Start Date & Time</label>
                                        <input type="datetime-local" name="date" class="w-full p-2 border rounded-md" value="${event.date.replace('Z', '')}" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">End Date & Time</label>
                                        <input type="datetime-local" name="endDate" class="w-full p-2 border rounded-md" value="${event.endDate.replace('Z', '')}" required>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Location</label>
                                    <input type="text" name="location" class="w-full p-2 border rounded-md" value="${event.location}" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Organizer</label>
                                    <input type="text" name="organizer" class="w-full p-2 border rounded-md" value="${event.organizer}" required>
                                </div>
                                ${state.currentRole === 'admin' ? `
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Faculty Coordinator</label>
                                    <select name="facultyCoordinator" class="w-full p-2 border rounded-md" required>
                                        <option value="Dr. Ramesh Gupta" ${event.facultyCoordinator === 'Dr. Ramesh Gupta' ? 'selected' : ''}>Dr. Ramesh Gupta</option>
                                        <option value="Dr. Sunita Patel" ${event.facultyCoordinator === 'Dr. Sunita Patel' ? 'selected' : ''}>Dr. Sunita Patel</option>
                                        <option value="Dr. Anjali Mehta" ${event.facultyCoordinator === 'Dr. Anjali Mehta' ? 'selected' : ''}>Dr. Anjali Mehta</option>
                                    </select>
                                </div>
                                ` : ''}
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Tags (comma-separated)</label>
                                    <input type="text" name="tags" class="w-full p-2 border rounded-md" value="${event.tags.join(', ')}" placeholder="e.g., coding, workshop, competition">
                                </div>
                            </div>
                        `;
                        FormModal("Edit Event", formContent, (formData) => {
                            event.title = formData.get('title');
                            event.description = formData.get('description');
                            event.category = formData.get('category');
                            event.date = formData.get('date');
                            event.endDate = formData.get('endDate');
                            event.location = formData.get('location');
                            event.organizer = formData.get('organizer');
                            event.capacity = parseInt(formData.get('capacity'));
                            event.tags = formData.get('tags') ? formData.get('tags').split(',').map(s => s.trim()) : [];
                            
                            if (state.currentRole === 'admin') {
                                event.facultyCoordinator = formData.get('facultyCoordinator');
                            }
                            
                            showToast("Event updated successfully!");
                            render();
                        });
                    }
                });
            });
            
            // Delete event functionality
            document.querySelectorAll('.delete-event-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const eventId = parseInt(e.currentTarget.dataset.eventId);
                    const event = state.events.find(e => e.id === eventId);
                    if (event && confirm(`Are you sure you want to delete "${event.title}"? This action cannot be undone.`)) {
                        state.events = state.events.filter(e => e.id !== eventId);
                        
                        // If faculty, remove from managed events
                        if (state.currentRole === 'faculty') {
                            state.facultyData.managedEvents = state.facultyData.managedEvents.filter(id => id !== eventId);
                        }
                        
                        showToast("Event deleted successfully!");
                        render();
                    }
                });
            });
            
            // Check-in functionality for faculty
            document.querySelectorAll('.check-in-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const eventId = parseInt(e.currentTarget.dataset.eventId);
                    const participantId = parseInt(e.currentTarget.dataset.participantId);
                    const event = state.events.find(e => e.id === eventId);
                    if (event) {
                        const participant = event.participants.find(p => p.id === participantId);
                        if (participant) {
                            participant.checkIn = new Date().toISOString();
                            showToast(`${participant.name} checked in successfully!`);
                            render();
                        }
                    }
                });
            });
            
            // Undo check-in functionality for faculty
            document.querySelectorAll('.undo-check-in-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const eventId = parseInt(e.currentTarget.dataset.eventId);
                    const participantId = parseInt(e.currentTarget.dataset.participantId);
                    const event = state.events.find(e => e.id === eventId);
                    if (event) {
                        const participant = event.participants.find(p => p.id === participantId);
                        if (participant) {
                            participant.checkIn = null;
                            showToast(`Check-in undone for ${participant.name}`);
                            render();
                        }
                    }
                });
            });
            
            // Suggestion approval/rejection for admin
            document.querySelectorAll('.suggestion-action-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const suggestionId = parseInt(e.currentTarget.dataset.suggestionId);
                    const action = e.currentTarget.dataset.action;
                    const suggestion = state.topicSuggestions.find(s => s.id === suggestionId);
                    
                    if (suggestion) {
                        if (action === 'approve') {
                            suggestion.status = 'approved';
                            showToast(`Suggestion "${suggestion.title}" has been approved!`);
                        } else {
                            // For rejection, we need to ask for a reason
                            const reason = prompt('Please provide a reason for rejecting this suggestion:');
                            if (reason) {
                                suggestion.status = 'rejected';
                                suggestion.rejectionReason = reason;
                                showToast(`Suggestion "${suggestion.title}" has been rejected.`);
                            } else {
                                return; // User cancelled
                            }
                        }
                        render();
                    }
                });
            });
            
            // Create event from suggestion for admin
            document.querySelectorAll('.create-event-from-suggestion-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const suggestionId = parseInt(e.currentTarget.dataset.suggestionId);
                    const suggestion = state.topicSuggestions.find(s => s.id === suggestionId);
                    
                    if (suggestion) {
                        // Pre-fill the create event form with suggestion data
                        const formContent = `
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Event Title</label>
                                    <input type="text" name="title" class="w-full p-2 border rounded-md" value="${suggestion.title}" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Description</label>
                                    <textarea name="description" rows="3" class="w-full p-2 border rounded-md" required>${suggestion.description}</textarea>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Category</label>
                                        <select name="category" class="w-full p-2 border rounded-md" required>
                                            <option value="${suggestion.category}" selected>${suggestion.category.charAt(0).toUpperCase() + suggestion.category.slice(1)}</option>
                                            <option value="tech">Technology</option>
                                            <option value="cultural">Cultural</option>
                                            <option value="sports">Sports</option>
                                            <option value="academic">Academic</option>
                                            <option value="workshop">Workshop</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Capacity</label>
                                        <input type="number" name="capacity" class="w-full p-2 border rounded-md" value="100" required>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Start Date & Time</label>
                                        <input type="datetime-local" name="date" class="w-full p-2 border rounded-md" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">End Date & Time</label>
                                        <input type="datetime-local" name="endDate" class="w-full p-2 border rounded-md" required>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Location</label>
                                    <input type="text" name="location" class="w-full p-2 border rounded-md" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Organizer</label>
                                    <input type="text" name="organizer" class="w-full p-2 border rounded-md" value="Based on community suggestion" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Faculty Coordinator</label>
                                    <select name="facultyCoordinator" class="w-full p-2 border rounded-md" required>
                                        <option value="Dr. Ramesh Gupta">Dr. Ramesh Gupta</option>
                                        <option value="Dr. Sunita Patel">Dr. Sunita Patel</option>
                                        <option value="Dr. Anjali Mehta">Dr. Anjali Mehta</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Tags (comma-separated)</label>
                                    <input type="text" name="tags" class="w-full p-2 border rounded-md" value="${suggestion.category}" placeholder="e.g., coding, workshop, competition">
                                </div>
                            </div>
                        `;
                        FormModal("Create Event from Suggestion", formContent, (formData) => {
                            const newEvent = {
                                id: state.events.length + 1,
                                title: formData.get('title'),
                                description: formData.get('description'),
                                category: formData.get('category'),
                                date: formData.get('date'),
                                endDate: formData.get('endDate'),
                                location: formData.get('location'),
                                organizer: formData.get('organizer'),
                                capacity: parseInt(formData.get('capacity')),
                                registered: 0,
                                image: `https://placehold.co/600x400/3B82F6/FFFFFF?text=${encodeURIComponent(formData.get('title'))}`,
                                status: 'upcoming',
                                tags: formData.get('tags') ? formData.get('tags').split(',').map(s => s.trim()) : [],
                                registrationDeadline: new Date(new Date(formData.get('date')).getTime() - 24 * 60 * 60 * 1000).toISOString(),
                                isRegistered: false,
                                reminders: [],
                                facultyCoordinator: formData.get('facultyCoordinator'),
                                participants: []
                            };
                            state.events.unshift(newEvent);
                            showToast("Event created from suggestion successfully!");
                            render();
                        });
                    }
                });
            });
            
            // Add user functionality for admin
            document.getElementById('add-user-btn')?.addEventListener('click', () => {
                const formContent = `
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Full Name</label>
                            <input type="text" name="name" class="w-full p-2 border rounded-md" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Email</label>
                            <input type="email" name="email" class="w-full p-2 border rounded-md" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Department</label>
                            <input type="text" name="department" class="w-full p-2 border rounded-md" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Role</label>
                            <select name="role" class="w-full p-2 border rounded-md" required>
                                <option value="student">Student</option>
                                <option value="faculty">Faculty</option>
                                <option value="admin">Administrator</option>
                            </select>
                        </div>
                    </div>
                `;
                FormModal("Add New User", formContent, (formData) => {
                    const newUser = {
                        id: state.users.length + 1,
                        name: formData.get('name'),
                        email: formData.get('email'),
                        department: formData.get('department'),
                        role: formData.get('role'),
                        status: 'active'
                    };
                    state.users.push(newUser);
                    showToast("User added successfully!");
                    render();
                });
            });
            
            // Edit user functionality for admin
            document.querySelectorAll('.edit-user-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const userId = parseInt(e.currentTarget.dataset.userId);
                    const user = state.users.find(u => u.id === userId);
                    if (user) {
                        const formContent = `
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Full Name</label>
                                    <input type="text" name="name" class="w-full p-2 border rounded-md" value="${user.name}" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Email</label>
                                    <input type="email" name="email" class="w-full p-2 border rounded-md" value="${user.email}" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Department</label>
                                    <input type="text" name="department" class="w-full p-2 border rounded-md" value="${user.department}" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Role</label>
                                    <select name="role" class="w-full p-2 border rounded-md" required>
                                        <option value="student" ${user.role === 'student' ? 'selected' : ''}>Student</option>
                                        <option value="faculty" ${user.role === 'faculty' ? 'selected' : ''}>Faculty</option>
                                        <option value="admin" ${user.role === 'admin' ? 'selected' : ''}>Administrator</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Status</label>
                                    <select name="status" class="w-full p-2 border rounded-md" required>
                                        <option value="active" ${user.status === 'active' ? 'selected' : ''}>Active</option>
                                        <option value="inactive" ${user.status === 'inactive' ? 'selected' : ''}>Inactive</option>
                                    </select>
                                </div>
                            </div>
                        `;
                        FormModal("Edit User", formContent, (formData) => {
                            user.name = formData.get('name');
                            user.email = formData.get('email');
                            user.department = formData.get('department');
                            user.role = formData.get('role');
                            user.status = formData.get('status');
                            showToast("User updated successfully!");
                            render();
                        });
                    }
                });
            });
            
            // Deactivate user functionality for admin
            document.querySelectorAll('.deactivate-user-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const userId = parseInt(e.currentTarget.dataset.userId);
                    const user = state.users.find(u => u.id === userId);
                    if (user && confirm(`Are you sure you want to ${user.status === 'active' ? 'deactivate' : 'activate'} ${user.name}?`)) {
                        user.status = user.status === 'active' ? 'inactive' : 'active';
                        showToast(`User ${user.name} has been ${user.status === 'active' ? 'activated' : 'deactivated'}!`);
                        render();
                    }
                });
            });
            
            // CSV download functionality
            document.getElementById('download-analytics-csv')?.addEventListener('click', () => {
                const managedEvents = state.events.filter(e => state.facultyData.managedEvents.includes(e.id));
                const analyticsData = managedEvents.map(event => {
                    const checkedIn = event.participants.filter(p => p.checkIn !== null).length;
                    const attendanceRate = event.participants.length > 0 ? 
                        ((checkedIn / event.participants.length) * 100).toFixed(1) : 0;
                    return {
                        event: event.title,
                        date: formatDate(event.date),
                        capacity: event.capacity,
                        registered: event.participants.length,
                        checked_in: checkedIn,
                        attendance_rate: `${attendanceRate}%`
                    };
                });
                downloadCSV(analyticsData, 'faculty_analytics');
            });
            
            document.getElementById('download-events-csv')?.addEventListener('click', () => {
                const eventsData = state.events.map(event => {
                    const eventStatus = getEventStatus(event);
                    return {
                        title: event.title,
                        category: event.category,
                        date: formatDate(event.date),
                        location: event.location,
                        organizer: event.organizer,
                        coordinator: event.facultyCoordinator,
                        capacity: event.capacity,
                        registered: event.registered,
                        status: eventStatus
                    };
                });
                downloadCSV(eventsData, 'all_events');
            });
            
            document.getElementById('download-users-csv')?.addEventListener('click', () => {
                const usersData = state.users.map(user => {
                    return {
                        name: user.name,
                        email: user.email,
                        department: user.department,
                        role: user.role,
                        status: user.status
                    };
                });
                downloadCSV(usersData, 'all_users');
            });
        }

        // --- SCRIPT INITIALIZATION ---
        render();
    </script>
</body>
</html>